<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MQTTSuite: MQTTSuite</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra-style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">MQTTSuite
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">MQTTSuite </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p align="center"><a class="anchor" id="md_README"></a> </p>
<p><img src="./docs/assets/README/Logo-New-Full.png" alt="" style="width: 50%;" class="inline"/></p>
<p>The <a href="https://snodec.github.io/mqttsuite-doc/html/index.html"><em>MQTTSuite</em></a> project is a lightweight MQTT integration system and consist of three applications <em>MQTTBroker</em>, <em>MQTTIntegrator</em> and <em>MQTTBridge</em> powered by <em><a href="https://github.com/VolkerChristian/snode.c">SNode.C</a></em>, a single threaded, single tasking framework for networking applications written entirely in C++. Due to it's little resource usage it is especially usable on resource limited systems.</p>
<ul>
<li><b>MQTTBroker</b>: Is a full featured MQTT broker utilizing version <a href="https://docs.oasis-open.org/mqtt/mqtt/v3.1.1/mqtt-v3.1.1.html">3.1.1</a> of the MQTT protocol standard. It accepts encrypted and unencrypted incoming plain and WebSockets MQTT connections. In addition it provides a rudimentary Web-Interface showing all currently connected MQTT-clients.</li>
<li><b>MQTTIntegrator</b>: Is a IoT integration application controlled by a JSON-mapping description. It connects via SSL/TLS to an MQTT-broker.</li>
<li><b>MQTTBridge</b>: Is a purely client side bridge. It can establish multiple bridges each connecting to multiple mqtt brokers and bridges configurable topics among them.</li>
</ul>
<h1><a class="anchor" id="table-of-content"></a>
Table of Content</h1>
<ul>
<li><a class="el" href="index.html#table-of-content">Table of Content</a></li>
<li><a class="el" href="index.html#license">License</a></li>
<li><a class="el" href="index.html#copyright">Copyright</a></li>
<li><a class="el" href="index.html#installation">Installation</a><ul>
<li><a class="el" href="index.html#supported-systems-and-hardware">Supported Systems and Hardware</a></li>
<li><a class="el" href="index.html#minimum-required-compiler-versions">Minimum required Compiler Versions</a></li>
<li><a class="el" href="index.html#requirements-and-dependencies">Requirements and Dependencies</a><ul>
<li><a class="el" href="index.html#tools">Tools</a><ul>
<li><a class="el" href="index.html#mandatory">Mandatory</a></li>
<li><a class="el" href="index.html#optional">Optional</a></li>
</ul>
</li>
<li><a class="el" href="index.html#frameworks">Frameworks</a><ul>
<li><a class="el" href="index.html#mandatory-1">Mandatory</a></li>
</ul>
</li>
<li><a class="el" href="index.html#libraries">Libraries</a><ul>
<li><a class="el" href="index.html#mandatory-2">Mandatory</a></li>
<li><a class="el" href="index.html#bundled">Bundled</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="el" href="index.html#installation-on-debian-style-systems-x86-64-arm">Installation on Debian Style Systems (x86-64, Arm)</a><ul>
<li><a class="el" href="index.html#requirements-and-dependencies-1">Requirements and Dependencies</a></li>
<li><a class="el" href="index.html#mqttsuite">MQTTSuite</a></li>
</ul>
</li>
<li><a class="el" href="index.html#deploment-on-openwrt">Deploment on OpenWRT</a><ul>
<li><a class="el" href="index.html#choose-and-download-a-sdk">Choose and Download a SDK</a></li>
<li><a class="el" href="index.html#patch-the-sdk-to-integrate-the-mqttsuite-feed">Patch the SDK to Integrate the MQTTSuite Feed</a></li>
<li><a class="el" href="index.html#install-the-mqttsuite-package-and-its-dependencies">Install the MQTTSuite Package and its Dependencies</a></li>
<li><a class="el" href="index.html#configure-the-sdk">Configure the SDK</a></li>
<li><a class="el" href="index.html#cross-compile-mqttsuite">Cross Compile MQTTSuite</a></li>
<li><a class="el" href="index.html#deploy-mqttsuite">Deploy MQTTSuite</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="el" href="index.html#mqttsuite-usage-guide">MQTTSuite Usage Guide</a><ul>
<li><a class="el" href="index.html#mqttbroker">MQTTBroker</a><ul>
<li><a class="el" href="index.html#connection-options">Connection Options</a><ul>
<li><a class="el" href="index.html#mqtt-over-tcpip">MQTT over TCP/IP</a></li>
<li><a class="el" href="index.html#mqtt-over-unix-domain-sockets">MQTT over Unix Domain Sockets</a></li>
<li><a class="el" href="index.html#mqtt-over-websockets">MQTT over WebSockets</a></li>
</ul>
</li>
<li><a class="el" href="index.html#web-interface">Web Interface</a></li>
</ul>
</li>
<li><a class="el" href="index.html#mqttintegrator">MQTTIntegrator</a><ul>
<li><a class="el" href="index.html#connection-options-1">Connection Options</a><ul>
<li><a class="el" href="index.html#mqtt-over-tcpip-1">MQTT over TCP/IP</a></li>
<li><a class="el" href="index.html#mqtt-over-unix-domain-sockets-1">MQTT over Unix Domain Sockets</a></li>
<li><a class="el" href="index.html#mqtt-over-websockets-1">MQTT over WebSockets</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="el" href="index.html#mqtt-mapping-description">MQTT Mapping Description</a><ul>
<li><a class="el" href="index.html#the-structure-of-the-json-mapping-description">The Structure of the JSON Mapping Description</a></li>
<li><a class="el" href="index.html#topic-levels-and-the-json-structure-of-the-mapping-section">Topic Levels and the JSON-Structure of the mapping Section</a><ul>
<li><a class="el" href="index.html#single-topic-level">Single Topic Level</a></li>
<li><a class="el" href="index.html#nested-topic-levels">Nested Topic Levels</a></li>
<li><a class="el" href="index.html#sibling-and-nested-topic-levels">Sibling and Nested Topic Levels</a></li>
<li><a class="el" href="index.html#a-more-complex-topic-level-structure">A More Complex Topic Level Structure</a></li>
<li><a class="el" href="index.html#the-subscription-object-of-a-topic-level">The subscription Object of a Topic Level</a><ul>
<li><a class="el" href="index.html#static-mapping">&lt;strong&gt;Static&lt;/strong&gt; Mapping</a></li>
<li><a class="el" href="index.html#value-mapping">&lt;strong&gt;Value&lt;/strong&gt; Mapping</a></li>
<li><a class="el" href="index.html#json-mapping">&lt;strong&gt;JSON&lt;/strong&gt; Mapping</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="license"></a>
License</h1>
<p>SNode.C is dual-licensed under MIT and GPL-3.0 (or any later version). You can choose between one of them if you use this work.</p>
<p><code>SPDX-License-Identifier: MIT OR GPL-3.0-or-later</code></p>
<h1><a class="anchor" id="copyright"></a>
Copyright</h1>
<p>Volker Christian (<a href="#" onclick="location.href='mai'+'lto:'+'me@'+'vc'+'hri'+'st'+'.at'; return false;">me@vchrist.at</a> or <a href="#" onclick="location.href='mai'+'lto:'+'vol'+'ke'+'r.c'+'hr'+'ist'+'ia'+'n@f'+'h-'+'hag'+'en'+'ber'+'g.'+'at'; return false;">Volker.Christian@fh-hagenberg.at</a>)</p>
<h1><a class="anchor" id="installation"></a>
Installation</h1>
<p>The installation of the MQTTSuite is straight forward:</p>
<ul>
<li>In a first step the network framework SNode.C needs to be installed</li>
<li>In a second step all neccessary tools and libraries are installed.</li>
<li>Afterwards the MQTTSuite can be cloned, compiled and installed.</li>
</ul>
<h2><a class="anchor" id="supported-systems-and-hardware"></a>
Supported Systems and Hardware</h2>
<p>The main development of MQTTSuite takes place on a <em>Debian Sid</em> style Linux system. Since <em>Debian Bookworm</em> it compiles also on <em>Debian stable</em>. Though, it should compile cleanly on every Linux system provided that all required tools and libraries are installed.</p>
<p>MQTTSuite is known to compile and run successful on</p>
<ul>
<li><b>x86-64</b> architecture</li>
<li><b>Arm</b> architecture (32 and 64 bit) tested on<ul>
<li>Raspberry Pi 3, 4 and 5</li>
</ul>
</li>
<li><b>OpenWrt</b> 23.05.0 and later<ul>
<li>All architectures</li>
</ul>
</li>
<li><b>Android</b> via <a href="https://termux.dev/en/">Termux</a><ul>
<li>Documentation in preparation</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="minimum-required-compiler-versions"></a>
Minimum required Compiler Versions</h2>
<p>The most version-critical dependencies are the C++ compilers.</p>
<p>Either <em>GCC</em> or <em>clang</em> can be used but they need to be of an up to date version because SNode.C uses some new C++20 features internally.</p>
<ul>
<li>GCC 12.2 and later</li>
<li>Clang 13.0 and later</li>
</ul>
<h2><a class="anchor" id="requirements-and-dependencies"></a>
Requirements and Dependencies</h2>
<p>MQTTSuite requires some external tools and depends on a view external libraries. Some of these libraries are directly included in the MQTTSuite.</p>
<h3><a class="anchor" id="tools"></a>
Tools</h3>
<h4><a class="anchor" id="mandatory"></a>
Mandatory</h4>
<ul>
<li>git (<a href="https://git-scm.com/">https://git-scm.com/</a>)</li>
<li>cmake (<a href="https://cmake.org/">https://cmake.org/</a>)</li>
<li>make (<a href="https://www.gnu.org/software/make/">https://www.gnu.org/software/make/</a>) or</li>
<li>ninja (<a href="https://ninja-build.org/">https://ninja-build.org/</a>)</li>
<li>g++ (<a href="https://gcc.gnu.org/">https://gcc.gnu.org/</a>) or</li>
<li>clang (<a href="https://clang.llvm.org/">https://clang.llvm.org/</a>)</li>
<li>pkg-config (<a href="https://www.freedesktop.org/wiki/Software/pkg-config/">https://www.freedesktop.org/wiki/Software/pkg-config/</a>)</li>
</ul>
<h4><a class="anchor" id="optional"></a>
Optional</h4>
<ul>
<li>iwyu (<a href="https://include-what-you-use.org/">https://include-what-you-use.org/</a>)</li>
<li>clang-format (<a href="https://clang.llvm.org/docs/ClangFormat.html">https://clang.llvm.org/docs/ClangFormat.html</a>)</li>
<li>cmake-format (<a href="https://cmake-format.readthedocs.io/">https://cmake-format.readthedocs.io/</a>)</li>
<li>doxygen (<a href="https://www.doxygen.nl/">https://www.doxygen.nl/</a>)</li>
</ul>
<h3><a class="anchor" id="frameworks"></a>
Frameworks</h3>
<h4><a class="anchor" id="mandatory-1"></a>
Mandatory</h4>
<ul>
<li>SNode.C: Simple NODE in C++ (<a href="https://github.com/SNodeC/snode.c">https://github.com/SNodeC/snode.c</a>)</li>
</ul>
<h3><a class="anchor" id="libraries"></a>
Libraries</h3>
<h4><a class="anchor" id="mandatory-2"></a>
Mandatory</h4>
<ul>
<li>libfmt (11.0.0 or later) development files (<a href="https://github.com/fmtlib/fmt">https://github.com/fmtlib/fmt</a>)</li>
</ul>
<h4><a class="anchor" id="bundled"></a>
Bundled</h4>
<p>This libraries are already integrated directly in the MQTTSuite. Thus they need not be installed by hand</p>
<ul>
<li>JSON Schema Validator for Modern C++ (<a href="https://github.com/pboettch/json-schema-validator">https://github.com/pboettch/json-schema-validator</a>)</li>
<li>inja: A Template Engine for Modern C++ (<a href="https://github.com/pantor/inja">https://github.com/pantor/inja</a>)</li>
</ul>
<h2><a class="anchor" id="installation-on-debian-style-systems-x86-64-arm"></a>
Installation on Debian Style Systems (x86-64, Arm)</h2>
<h3><a class="anchor" id="requirements-and-dependencies-1"></a>
Requirements and Dependencies</h3>
<p>To install all dependencies on Debian style system</p>
<ul>
<li>install SNode.C (<a href="https://github.com/SNodeC/snode.c?tab=readme-ov-file#installation">https://github.com/SNodeC/snode.c?tab=readme-ov-file#installation</a>)</li>
<li><p class="startli">and than just run</p>
<div class="fragment"><div class="line">sudo apt update</div>
<div class="line">sudo apt install libfmt-dev</div>
</div><!-- fragment --></li>
</ul>
<h3><a class="anchor" id="mqttsuite"></a>
MQTTSuite</h3>
<p>After installing all dependencies MQTTSuite can be cloned from github, compiled and installed.</p>
<div class="fragment"><div class="line">mkdir mqttsuite</div>
<div class="line">cd mqttsuite</div>
<div class="line">git clone https://github.com/SNodeC/mqttsuite.git</div>
<div class="line">mkdir build</div>
<div class="line">cd build</div>
<div class="line">cmake ../mqttsuite</div>
<div class="line">make</div>
<div class="line">sudo make install</div>
<div class="line">sudo ldconfig</div>
</div><!-- fragment --><p>It is a good idea to utilize all processor cores and threads for compilation. Thus e.g. on a Raspberry Pi append <code>-j5</code> to the <code>make</code> or <code>ninja</code> command.</p>
<h2><a class="anchor" id="deploment-on-openwrt"></a>
Deploment on OpenWRT</h2>
<p>As a starting point, it is assumed that local <em>ssh</em> and <em>sftp</em> access to the router exist and that the router is connected to the Internet via the WAN port.</p>
<p><em><b>Note:</b></em> You <em>do not need</em> to deploy SNode.C by hand as this framework is <em>pulled in</em> by the following procedure <em>automatically</em>.</p>
<p>Deploying SNode.C on an OpenWRT router involves a view tasks:</p>
<ol type="1">
<li>Choose and download an OpenWRT-SDK</li>
<li>Patch the SDK to integrate the SNode.C feed</li>
<li>Install the MQTTSuite package and its dependencies</li>
<li>Configure the SDK</li>
<li>Cross compile MQTTSuite</li>
<li>Deploy MQTTSuite</li>
</ol>
<p>MQTTSuite needs to be <em>cross compiled</em> on a Linux host system to be deployable on OpenWRT. Don't be afraid about cross compiling it is strait forward.</p>
<h3><a class="anchor" id="choose-and-download-a-sdk"></a>
Choose and Download a SDK</h3>
<p>First, download and extract a SDK-package of version 23.05.0-rc1 or later from the <a href="https://downloads.openwrt.org/">OpenWRT download page</a> into an arbitrary directory &lt;DIR&gt;.</p>
<p>For example to download and use the SDK version 23.05.0-rc1 for the Netgear MR8300 Wireless Router (soc: IPQ4019) run</p>
<div class="fragment"><div class="line">cd &lt;DIR&gt;</div>
<div class="line">wget -qO - https://downloads.openwrt.org/releases/23.05.0-rc2/targets/ipq40xx/generic/openwrt-sdk-23.05.0-rc2-ipq40xx-generic_gcc-12.3.0_musl_eabi.Linux-x86_64.tar.xz | tar Jx</div>
</div><!-- fragment --><p>to create the SDK directory <code>openwrt-sdk-&lt;version&gt;-&lt;architecture&gt;-&lt;atype&gt;_&lt;compiler&gt;-&lt;cverstion&gt;_&lt;libc&gt;_&lt;abi&gt;.Linux-x86_64</code> what from now on is referred as &lt;SDK_DIR&gt;.</p>
<p>In this example the values of the placeholder are:</p>
<ul>
<li>&lt;version&gt; = 23.05.0-rc2</li>
<li>&lt;architecture&gt; = ipq40xx_</li>
<li>&lt;atype&gt; = generic</li>
<li>&lt;compiler&gt; = gcc</li>
<li>&lt;cverstion&gt; = 12.3.0</li>
<li>&lt;libc&gt; = musl</li>
<li>&lt;abi&gt; = eabi</li>
</ul>
<h3><a class="anchor" id="patch-the-sdk-to-integrate-the-mqttsuite-feed"></a>
Patch the SDK to Integrate the MQTTSuite Feed</h3>
<p>Second step is to patch the default OpenWRT package feeds to add the SNode.C feed (MQTTSuite is provided by this feed) by executing</p>
<div class="fragment"><div class="line">cd &lt;SDK_DIR&gt;</div>
<div class="line">echo &quot;src-git snodec https://github.com/SNodeC/OpenWRT&quot; &gt;&gt; feeds.conf.default</div>
</div><!-- fragment --><h3><a class="anchor" id="install-the-mqttsuite-package-and-its-dependencies"></a>
Install the MQTTSuite Package and its Dependencies</h3>
<p>In the third step, all source packages required to compile SNode.C are installed.</p>
<div class="fragment"><div class="line">cd &lt;SDK_DIR&gt;</div>
<div class="line">./scripts/feeds update base packages snodec # Only the feeds base, packages and snodec are necessary</div>
<div class="line">./scripts/feeds install mqttsuite</div>
</div><!-- fragment --><h3><a class="anchor" id="configure-the-sdk"></a>
Configure the SDK</h3>
<p>The SDK is configured in the fourth step.</p>
<div class="fragment"><div class="line">cd &lt;SDK_DIR&gt;</div>
<div class="line">make defconfig</div>
</div><!-- fragment --><p>Default values for all configuration options can be used safely.</p>
<p>Nevertheless, to customize the configuration of the base framework SNode.C run</p>
<div class="fragment"><div class="line">cd &lt;SDK_DIR&gt;</div>
<div class="line">make menuconfig</div>
</div><!-- fragment --><p>and navigate to <code>Network -&gt; SNode.C</code>.</p>
<h3><a class="anchor" id="cross-compile-mqttsuite"></a>
Cross Compile MQTTSuite</h3>
<p>In the last step, MQTTSuite is cross-compiled.</p>
<div class="fragment"><div class="line">cd &lt;SDK_DIR&gt;</div>
<div class="line">make package/mqttsuite/compile</div>
</div><!-- fragment --><p>The two steps, <em>Install Packages</em>, and <em>Cross Compile</em> (at most the last one) take some time as</p>
<ol type="1">
<li>all feed and package definitions necessary to cross compile MQTTSuite are downloaded and installed locally from the OpenWRT servers and from github,</li>
<li>the sources of all dependent and indirect dependent packages are downloaded from upstream and build recursively and</li>
<li>MQTTSuite is cloned from github and cross compiled.</li>
</ol>
<p>To parallelize the compilation use the switch <code>-j&lt;thread-count&gt;</code> of <code>make</code> or <code>ninja</code> where &lt;thread-count&gt; is the number of CPU-threads dedicated to cross compile SNode.C and its dependencies.</p>
<p><em><b>Note:</b></em> For MQTTBroker and all it's build dependencies the created <em>ipk-packages</em> can be found in the directory <code>&lt;SDK_DIR&gt;bin/packages/\&lt;architecture\&gt;</code>.</p>
<h3><a class="anchor" id="deploy-mqttsuite"></a>
Deploy MQTTSuite</h3>
<p>After cross compilation, MQTTSuite can be deployed.</p>
<p>The <code>mqttsuite_&lt;version&gt;_&lt;architecture&gt;.ipk</code> and <code>snode.c-*_&lt;version&gt;_&lt;architecture&gt;.ipk</code> packages must be downloaded to and installed on the router by executing</p>
<div class="fragment"><div class="line">cd &lt;SDK_DIR&gt;/bin/packages/&lt;architecture&gt;/snodec</div>
<div class="line">sftp root@&lt;router-ip&gt;</div>
<div class="line">cd /tmp</div>
<div class="line">put snode.c*.ipk</div>
<div class="line">put mqttsuite*.ipk</div>
<div class="line">exit</div>
<div class="line">ssh root@&lt;router-ip&gt;</div>
<div class="line">cd /tmp</div>
<div class="line">opkg [--force-reinstall] install snode.c*.ipk mqttsuite*.ipk</div>
<div class="line">exit</div>
</div><!-- fragment --><p>on the router. Use the option <code>--force-reinstall</code> in cast you want to reinstall the same version by overwriting the currently installed files.</p>
<p><em><b>Note:</b></em> On first install of MQTTSuite and SNode.C you will for sure get errors about missing dependent packages from the primary OpenWRT package repository. Just install them as usual using opkg and than go on to install MQTTSuite and SNode.C again.</p>
<p>During package installation a new <em>unix group</em> with member <em>root</em> is created, used for the group management of config-, log-, and pid-files.</p>
<p><em><b>Note:</b></em> A logout/login is necessary to activate the new group assignment.</p>
<h1><a class="anchor" id="mqttsuite-usage-guide"></a>
MQTTSuite Usage Guide</h1>
<h2><a class="anchor" id="mqttbroker"></a>
MQTTBroker</h2>
<h3><a class="anchor" id="connection-options"></a>
Connection Options</h3>
<p>The <em>MQTTBroker</em> supports multiple connection methods across various protocols. Additional connection protocols e.g. Bluetooth can be easily added in the <a href="https://github.com/SNodeC/mqttsuite/blob/master/mqttbroker/mqttbroker.cpp"><code>mqttbroker.cpp</code></a> source code.</p>
<p>All aspects like port numbers, sun paths etc. can be configured using the <a href="https://github.com/SNodeC/snode.c?tab=readme-ov-file#configuration">SNode.C configuration system</a> either in-code, on the command line or via a configuration file.</p>
<p>In case an encrypted access is required <a href="https://github.com/SNodeC/snode.c?tab=readme-ov-file#ssltls-configuration-section-tls">suitable certificates needs to be provided</a> also.</p>
<p><em><b>Note:</b></em> A <em>session store</em> needs to be configured in case the current sessions shall be made persistent in case the MQTTBroker is stopped by using the command line option <code>--mqtt-session-store &lt;path-to-session-store-file&gt;</code>.</p>
<p><em><b>Note:</b></em> In case the MQTTBroker should also act as an integrated MQTTIntegrator a <em>mapping description file</em> needs to be provided via the command line option <code>--mqtt-mapping-file &lt;path-to-mqtt-mapping-file.json&gt;</code>.</p>
<p><em><b>Note:</b></em> The path to the HTML templates for the MQTTBroker Web Interface can be configured by providing the command line option <code>--html-dir &lt;dir-of-html-templates&gt;</code>. The default directory <code>/var/www/mqttsuite/mqttbroker</code> is already configured in <a href="https://github.com/SNodeC/mqttsuite/blob/master/mqttbroker/mqttbroker.cpp"><code>mqttbroker.cpp</code></a>.</p>
<p><em><b>Note:</b></em> All three options can be made <em>persistent</em> by storing their values in a <em>configuration file</em> by appending the switch <code>--write-config</code> or <code>-w</code> on the command line.</p>
<h4><a class="anchor" id="mqtt-over-tcpip"></a>
MQTT over TCP/IP</h4>
<p>MQTT clients can connect via <em>IPv4</em> and <em>IPv6</em> using both encrypted and unencrypted channels.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Protocol   </th><th class="markdownTableHeadNone">Encryption   </th><th class="markdownTableHeadNone">Local Port   </th><th class="markdownTableHeadNone"><a href="https://github.com/SNodeC/snode.c?tab=readme-ov-file#instance-configuration">Instance</a>    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>IPv4</b>   </td><td class="markdownTableBodyNone">No   </td><td class="markdownTableBodyNone"><code>1883</code>   </td><td class="markdownTableBodyNone"><code>in-mqtt</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>IPv4</b>   </td><td class="markdownTableBodyNone">Yes   </td><td class="markdownTableBodyNone"><code>8883</code>   </td><td class="markdownTableBodyNone"><code>in-mqtts</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>IPv6</b>   </td><td class="markdownTableBodyNone">No   </td><td class="markdownTableBodyNone"><code>1883</code>   </td><td class="markdownTableBodyNone"><code>in6-mqtt</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>IPv6</b>   </td><td class="markdownTableBodyNone">Yes   </td><td class="markdownTableBodyNone"><code>8883</code>   </td><td class="markdownTableBodyNone"><code>in6-mqtts</code>   </td></tr>
</table>
<h4><a class="anchor" id="mqtt-over-unix-domain-sockets"></a>
MQTT over Unix Domain Sockets</h4>
<p>For local communication, the broker also supports Unix domain sockets.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Encryption   </th><th class="markdownTableHeadNone">Local Sun Path   </th><th class="markdownTableHeadNone"><a href="https://github.com/SNodeC/snode.c?tab=readme-ov-file#instance-configuration">Instance</a>    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">No   </td><td class="markdownTableBodyNone"><code>/tmp/mqttbroker-un-mqtt</code>   </td><td class="markdownTableBodyNone"><code>un-mqtt</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Yes   </td><td class="markdownTableBodyNone"><code>/tmp/mqttbroker-un-mqtts</code>   </td><td class="markdownTableBodyNone"><code>un-mqtts</code>   </td></tr>
</table>
<h4><a class="anchor" id="mqtt-over-websockets"></a>
MQTT over WebSockets</h4>
<p>Clients can connect via WebSockets using both <em>IPv4</em> and <em>IPv6</em>.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Protocol   </th><th class="markdownTableHeadNone">Encryption   </th><th class="markdownTableHeadNone">Local Port   </th><th class="markdownTableHeadNone">Request Target   </th><th class="markdownTableHeadNone">Sec-WebSocket-Protocol   </th><th class="markdownTableHeadNone"><a href="https://github.com/SNodeC/snode.c?tab=readme-ov-file#instance-configuration">Instance</a>    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>IPv4</b>   </td><td class="markdownTableBodyNone">No   </td><td class="markdownTableBodyNone"><code>8080</code>   </td><td class="markdownTableBodyNone"><code>/</code> or <code>/ws</code>   </td><td class="markdownTableBodyNone"><code>mqtt</code>   </td><td class="markdownTableBodyNone"><code>in-http</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>IPv4</b>   </td><td class="markdownTableBodyNone">Yes   </td><td class="markdownTableBodyNone"><code>8088</code>   </td><td class="markdownTableBodyNone"><code>/</code> or <code>/ws</code>   </td><td class="markdownTableBodyNone"><code>mqtt</code>   </td><td class="markdownTableBodyNone"><code>in-https</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>IPv6</b>   </td><td class="markdownTableBodyNone">No   </td><td class="markdownTableBodyNone"><code>8080</code>   </td><td class="markdownTableBodyNone"><code>/</code> or <code>/ws</code>   </td><td class="markdownTableBodyNone"><code>mqtt</code>   </td><td class="markdownTableBodyNone"><code>in6-http</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>IPv6</b>   </td><td class="markdownTableBodyNone">Yes   </td><td class="markdownTableBodyNone"><code>8088</code>   </td><td class="markdownTableBodyNone"><code>/</code> or <code>/ws</code>   </td><td class="markdownTableBodyNone"><code>mqtt</code>   </td><td class="markdownTableBodyNone"><code>in6-https</code>   </td></tr>
</table>
<hr  />
<h3><a class="anchor" id="web-interface"></a>
Web Interface</h3>
<p>The <em>MQTTBroker Web Interface</em> provides real-time visibility into active client connections.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Protocol   </th><th class="markdownTableHeadNone">Encryption   </th><th class="markdownTableHeadNone">Local Port   </th><th class="markdownTableHeadNone">Request Target   </th><th class="markdownTableHeadNone"><a href="https://github.com/SNodeC/snode.c?tab=readme-ov-file#instance-configuration">Instance</a>    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>IPv4</b>   </td><td class="markdownTableBodyNone">No   </td><td class="markdownTableBodyNone"><code>8080</code>   </td><td class="markdownTableBodyNone"><code>/</code> or <code>/clients</code>   </td><td class="markdownTableBodyNone"><code>in-http</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>IPv4</b>   </td><td class="markdownTableBodyNone">Yes   </td><td class="markdownTableBodyNone"><code>8088</code>   </td><td class="markdownTableBodyNone"><code>/</code> or <code>/clients</code>   </td><td class="markdownTableBodyNone"><code>in-https</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>IPv6</b>   </td><td class="markdownTableBodyNone">No   </td><td class="markdownTableBodyNone"><code>8080</code>   </td><td class="markdownTableBodyNone"><code>/</code> or <code>/clients</code>   </td><td class="markdownTableBodyNone"><code>in6-http</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>IPv6</b>   </td><td class="markdownTableBodyNone">Yes   </td><td class="markdownTableBodyNone"><code>8088</code>   </td><td class="markdownTableBodyNone"><code>/</code> or <code>/clients</code>   </td><td class="markdownTableBodyNone"><code>in6-https</code>   </td></tr>
</table>
<h2><a class="anchor" id="mqttintegrator"></a>
MQTTIntegrator</h2>
<h3><a class="anchor" id="connection-options-1"></a>
Connection Options</h3>
<p>The <em>MQTTBroker</em> supports multiple connection methods across various protocols. Additional connection protocols e.g. Bluetooth can be easily added in the <a href="https://github.com/SNodeC/mqttsuite/blob/master/mqttintegrator/mqttintegrator.cpp"><code>mqttintegrator.cpp</code></a>source code.</p>
<p>All aspects like port numbers, sun paths etc. can be configured using the <a href="https://github.com/SNodeC/snode.c?tab=readme-ov-file#configuration">SNode.C configuration system</a> either in-code, on the command line or via a configuration file.</p>
<p>In case an encrypted access is required <a href="https://github.com/SNodeC/snode.c?tab=readme-ov-file#ssltls-configuration-section-tls">suitable certificates needs to be provided</a> also.</p>
<p><em><b>Note:</b></em> A <em>session store</em> needs to be configured in case the current sessions shall be made persistent in case the MQTTIntegrator is stopped by using the command line option <code>--mqtt-session-store &lt;path-to-session-store-file&gt;</code>.</p>
<p><em><b>Note:</b></em> A <em>mapping description file</em> needs to be provided via the command line option <code>--mqtt-mapping-file &lt;path-to-mqtt-mapping-file.json&gt;</code>. This JSON file is used to provide the IoT logic by mapping mqtt messages received from a mqtt broker to outgoing mqtt messages. The translation of topics and messages are described by that file.</p>
<p><em><b>Note:</b></em> Both options can be made <em>persistent</em> by storing their values in a <em>configuration file</em> by appending the switch <code>--write-config</code> or <code>-w</code> on the command line.</p>
<h4><a class="anchor" id="mqtt-over-tcpip-1"></a>
MQTT over TCP/IP</h4>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Protocol   </th><th class="markdownTableHeadNone">Encryption   </th><th class="markdownTableHeadNone">Remote Port   </th><th class="markdownTableHeadNone"><a href="https://github.com/SNodeC/snode.c?tab=readme-ov-file#instance-configuration">Instance</a>    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>IPv4</b>   </td><td class="markdownTableBodyNone">No   </td><td class="markdownTableBodyNone"><code>1883</code>   </td><td class="markdownTableBodyNone"><code>in-mqtt</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>IPv4</b>   </td><td class="markdownTableBodyNone">Yes   </td><td class="markdownTableBodyNone"><code>8883</code>   </td><td class="markdownTableBodyNone"><code>in-mqtts</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>IPv6</b>   </td><td class="markdownTableBodyNone">No   </td><td class="markdownTableBodyNone"><code>1883</code>   </td><td class="markdownTableBodyNone"><code>in6-mqtt</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>IPv6</b>   </td><td class="markdownTableBodyNone">Yes   </td><td class="markdownTableBodyNone"><code>8883</code>   </td><td class="markdownTableBodyNone"><code>in6-mqtts</code>   </td></tr>
</table>
<h4><a class="anchor" id="mqtt-over-unix-domain-sockets-1"></a>
MQTT over Unix Domain Sockets</h4>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Encryption   </th><th class="markdownTableHeadNone">Remote Sun Path   </th><th class="markdownTableHeadNone"><a href="https://github.com/SNodeC/snode.c?tab=readme-ov-file#instance-configuration">Instance</a>    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">No   </td><td class="markdownTableBodyNone"><code>/tmp/mqttbroker-un-mqtt</code>   </td><td class="markdownTableBodyNone"><code>un-mqtt</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Yes   </td><td class="markdownTableBodyNone"><code>/tmp/mqttbroker-un-mqtts</code>   </td><td class="markdownTableBodyNone"><code>un-mqtts</code>   </td></tr>
</table>
<h4><a class="anchor" id="mqtt-over-websockets-1"></a>
MQTT over WebSockets</h4>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Protocol   </th><th class="markdownTableHeadNone">Encryption   </th><th class="markdownTableHeadNone">Remote Port   </th><th class="markdownTableHeadNone">Requested Target   </th><th class="markdownTableHeadNone">Sec-WebSocket-Protocol   </th><th class="markdownTableHeadNone"><a href="https://github.com/SNodeC/snode.c?tab=readme-ov-file#instance-configuration">Instance</a>    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>IPv4</b>   </td><td class="markdownTableBodyNone">No   </td><td class="markdownTableBodyNone"><code>8080</code>   </td><td class="markdownTableBodyNone"><code>/ws</code>   </td><td class="markdownTableBodyNone"><code>mqtt</code>   </td><td class="markdownTableBodyNone"><code>in-wsmqtt</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>IPv4</b>   </td><td class="markdownTableBodyNone">Yes   </td><td class="markdownTableBodyNone"><code>8088</code>   </td><td class="markdownTableBodyNone"><code>/ws</code>   </td><td class="markdownTableBodyNone"><code>mqtt</code>   </td><td class="markdownTableBodyNone"><code>in-wsmqtts</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>IPv6</b>   </td><td class="markdownTableBodyNone">No   </td><td class="markdownTableBodyNone"><code>8080</code>   </td><td class="markdownTableBodyNone"><code>/ws</code>   </td><td class="markdownTableBodyNone"><code>mqtt</code>   </td><td class="markdownTableBodyNone"><code>in6-wsmqtt</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>IPv6</b>   </td><td class="markdownTableBodyNone">Yes   </td><td class="markdownTableBodyNone"><code>8088</code>   </td><td class="markdownTableBodyNone"><code>/ws</code>   </td><td class="markdownTableBodyNone"><code>mqtt</code>   </td><td class="markdownTableBodyNone"><code>in6-wsmqtts</code>   </td></tr>
</table>
<p><em><b>Note:</b></em> All instances are active after installation.</p>
<p><em><b>Note:</b></em> To inactivate (disable) instances selectively as they are not needed for communication the command line switch <code>--disabled</code> must be used on that instances.</p>
<h2><a class="anchor" id="mqtt-mapping-description"></a>
MQTT Mapping Description</h2>
<p>The logic of an IoT application is described by a JSON mapping description file. This file describes the translation of topics and messages of incoming mqtt messages from a mqtt broker. The translated topics and messages are send back to the broker.</p>
<p>The JSON structure of that file (<a href="https://github.com/SNodeC/mqttsuite/blob/master/mapfile.json">example</a>) needs to fulfill a well defined <a href="https://github.com/SNodeC/mqttsuite/blob/master/lib/mapping-schema.json">JSON schema definition</a>.</p>
<h3><a class="anchor" id="the-structure-of-the-json-mapping-description"></a>
The Structure of the JSON Mapping Description</h3>
<p>The big Structure of the JSON mapping description consists of three objects:</p>
<ul>
<li><code>discover_prefix</code>: The prefix topic-level of the discover topics of an application (currently not used).</li>
<li><code>connection</code>: This object describes options for the MQTT connection.</li>
<li><code>mapping</code>: This object describes the mappings of incoming topics|messages to outgoing topics/messages.</li>
</ul>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;discover_prefix&quot; : &quot;snode.c&quot;,         // discover prefix of the application (not used currently)</div>
<div class="line">    &quot;connection&quot; : {                       // connection options</div>
<div class="line">        &quot;keep_alive&quot; : 60,                 // [60]    duration between two ping packets</div>
<div class="line">        &quot;client_id&quot; : &quot;Client&quot;,            // [&quot;&quot;]    logical name of the client</div>
<div class="line">        &quot;clean_session&quot; : true,            // [true]  start with clean session or pick up retained one</div>
<div class="line">        &quot;will_topic&quot; : &quot;will/topic&quot;,       // [&quot;&quot;]    last will topic</div>
<div class="line">        &quot;will_message&quot; : &quot;Last Will&quot;,      // [&quot;&quot;]    last will message</div>
<div class="line">        &quot;will_qos&quot; : 0,                    // [0]     last will qos</div>
<div class="line">        &quot;will_retain&quot; : false,             // [false] retain last will or not</div>
<div class="line">        &quot;username&quot; : &quot;Username&quot;,           // [&quot;&quot;]    username</div>
<div class="line">        &quot;password&quot; : &quot;Password&quot;            // [&quot;&quot;]    password</div>
<div class="line">    },</div>
<div class="line">    &quot;mapping&quot; : {                          // mapping descriptions of templates|messages mapping</div>
<div class="line">        ...</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="topic-levels-and-the-json-structure-of-the-mapping-section"></a>
Topic Levels and the JSON-Structure of the &lt;tt&gt;mapping&lt;/tt&gt; Section</h3>
<ul>
<li>A <code>topic_level</code> is either<ul>
<li>an object describing one topic or</li>
<li>an <em>array</em> of objects describing multiple <em>sibling</em> topics</li>
</ul>
</li>
<li><code>topic_level</code>s can be <em>recursively nested</em> to create a <code>topic_level</code> tree.</li>
</ul>
<h4><a class="anchor" id="single-topic-level"></a>
Single Topic Level</h4>
<div class="fragment"><div class="line">&quot;mapping&quot; : {</div>
<div class="line">    &quot;topic_level&quot; : {         // single topic level</div>
<div class="line">        &quot;name&quot; : &quot;topic_level_name&quot;,</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --> <h4><a class="anchor" id="nested-topic-levels"></a>
Nested Topic Levels</h4>
<div class="fragment"><div class="line">&quot;mapping&quot; : {</div>
<div class="line">    &quot;topic_level&quot; : {         // parent topic level</div>
<div class="line">        &quot;name&quot; : &quot;topic_level_name&quot;,</div>
<div class="line">        &quot;topic_level&quot; : {     // sub-topic level</div>
<div class="line">            &quot;name&quot; : &quot;sub_topic_level_name&quot;,</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --> <h4><a class="anchor" id="sibling-and-nested-topic-levels"></a>
Sibling and Nested Topic Levels</h4>
<div class="fragment"><div class="line">&quot;mapping&quot; : {</div>
<div class="line">    &quot;topic_level&quot; : [{        // 1st sibling topic level</div>
<div class="line">        &quot;name&quot; : &quot;sibling_1_topic_level_name&quot;</div>
<div class="line">    }, {                      // 2nd sibling topic level</div>
<div class="line">        &quot;name&quot; : &quot;sibling_2_topic_level_name&quot;,</div>
<div class="line">        &quot;topic_level&quot; : {     // sub-topic level of 2nd sibling</div>
<div class="line">            &quot;name&quot; : &quot;sub_topic_level_name&quot;,</div>
<div class="line">        }</div>
<div class="line">    }]</div>
<div class="line">}</div>
</div><!-- fragment --><h4><a class="anchor" id="a-more-complex-topic-level-structure"></a>
A More Complex Topic Level Structure</h4>
<p><img src="docs/images/mqtt-topics.png" alt="A complexer topic_level Structure" class="inline"/></p>
<div class="fragment"><div class="line">&quot;mapping&quot; : {</div>
<div class="line">    &quot;topic_level&quot; : {</div>
<div class="line">        &quot;name&quot; : &quot;Home&quot;,</div>
<div class="line">        &quot;topic_level&quot; : [{</div>
<div class="line">            &quot;name&quot; : &quot;Bedroom&quot;,</div>
<div class="line">            &quot;topic_level&quot; : [{</div>
<div class="line">                &quot;name&quot; : &quot;...&quot;,</div>
<div class="line">            }, {</div>
<div class="line">                &quot;name&quot; : &quot;...&quot;,</div>
<div class="line">            }],</div>
<div class="line">        },</div>
<div class="line">        {</div>
<div class="line">            &quot;name&quot; : &quot;Garage&quot;,</div>
<div class="line">        },</div>
<div class="line">        {</div>
<div class="line">            &quot;name&quot; : &quot;Kitchen&quot;,</div>
<div class="line">            &quot;topic_level&quot; : [{</div>
<div class="line">                &quot;name&quot; : &quot;Fridge&quot;,</div>
<div class="line">                &quot;topic_level&quot; : [{</div>
<div class="line">                    &quot;name&quot; : &quot;Temperature&quot;,</div>
<div class="line">                },</div>
<div class="line">                {</div>
<div class="line">                    &quot;name&quot; : &quot;IceLevel&quot;,</div>
<div class="line">                }],</div>
<div class="line">            },</div>
<div class="line">            {</div>
<div class="line">                &quot;name&quot; : &quot;Coffeemaker&quot;,</div>
<div class="line">            }],</div>
<div class="line">        }]</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h4><a class="anchor" id="the-subscription-object-of-a-topic-level"></a>
The &lt;tt&gt;subscription&lt;/tt&gt; Object of a Topic Level</h4>
<p>The <code>topic_level</code> object can contain a <code>subscription</code> object, which forces the MQTTIntegrator to <em>subscribes for this topic</em>. This <code>subscription</code> object describes concrete <em>topic to topic</em> and <em>message to message</em> mappings.</p>
<div class="fragment"><div class="line">&quot;topic_level&quot; : {</div>
<div class="line">    &quot;name&quot; : &quot;device&quot;,</div>
<div class="line">    &quot;topic_level&quot; : {</div>
<div class="line">        &quot;name&quot; : &quot;sensor&quot;,</div>
<div class="line">        &quot;subscription&quot; : {</div>
<div class="line">            &quot;type&quot; : &quot;binary_sensor&quot;,</div>
<div class="line">            &quot;qos&quot; : 2,</div>
<div class="line">            &lt;mapping-section&gt;: {</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>Three different kinds of <code>&lt;mapping-section&gt;</code> exist:</p>
<ul>
<li><b>Static</b> mapping is thought for a <em>string-matching</em> mapping of incoming messages to outgoing one.</li>
<li><b>Value</b> mapping is used if the incoming message should be <em>interpreted as a value</em>. The actual mapping is done controlled by an <a href="https://github.com/pantor/inja"><em>inja</em></a> template, whereas the message is accessible via the template variable <code>message</code>.</li>
<li><b>JSON</b> mapping can be used in case the <em>incoming message</em> is a <em>JSON object</em>. The \alert{actual mapping} is done controlled by an <a href="https://github.com/pantor/inja"><em>inja</em></a> template. The JSON objects are accessible in the template <em>as elements</em> of the template JSON variable <code>message</code>.</li>
</ul>
<p><a class="anchor" id="static-mapping"></a> </p><h5><b>Static</b> Mapping</h5>
<p>The <code>static</code> mapping section describes the mapped topic and the message mapping where the <em>incoming message</em> is <em>string-matched</em> to <em>string-values</em> specified in the <code>message_mappings</code> array section.</p>
<div class="fragment"><div class="line">&quot;static&quot; : {</div>
<div class="line">    &quot;mapped_topic&quot; : &quot;other_device/some_actuator/set&quot;,</div>
<div class="line">    &quot;message_mapping&quot; : [{</div>
<div class="line">        &quot;message&quot;: &quot;pressed&quot;,      // original message</div>
<div class="line">        &quot;mapped_message&quot;: &quot;on&quot;     // mapped message</div>
<div class="line">    },</div>
<div class="line">    {</div>
<div class="line">        &quot;message&quot;: &quot;released&quot;,     // original message</div>
<div class="line">        &quot;mapped_message&quot;: &quot;off&quot;    // mapped message</div>
<div class="line">    }],</div>
<div class="line">    &quot;retain&quot; : false,</div>
<div class="line">    &quot;qos&quot;: 0</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="value-mapping"></a> </p><h5><b>Value</b> Mapping</h5>
<p>The <code>value</code> mapping section describes the <em>mapped topic</em> and the <em>message mapping</em> where the <em>incoming message</em> is available in the variable <code>message</code> and is interpreted as <em>value</em> of an <em>inja template</em>.</p>
<div class="fragment"><div class="line">&quot;value&quot; : {</div>
<div class="line">    &quot;mapped_topic&quot; : &quot;other_device/some_actuator/set&quot;,</div>
<div class="line">    &quot;mapping_template&quot; : &quot;{% if message == \&quot;pressed\&quot; %}on{% else if message == \&quot;released\&quot; %}off{% endif %}&quot;,</div>
<div class="line">    &quot;retain&quot; : false,</div>
<div class="line">    &quot;qos&quot; : 0</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="anchor" id="json-mapping"></a> </p><h5><b>JSON</b> Mapping</h5>
<p>The <code>json</code> mapping section can be used in case the <em>incoming message is a JSON</em> object. The actual mapping is controlled by an <em>inja template</em>. The <em>JSON object</em> is accessible in the template as <em>elements</em> of the template <em>JSON variable</em> <code>message</code>.</p>
<div class="fragment"><div class="line">&quot;json&quot; : {</div>
<div class="line">    &quot;mapped_topic&quot; : &quot;other_device/some_actuator/set&quot;,</div>
<div class="line">    &quot;mapping_template&quot; :  &quot;{{ message.time.start }} to {{ message.time.end + 1 }}pm&quot;,</div>
<div class="line">    &quot;retain&quot; : false,</div>
<div class="line">    &quot;qos&quot; : 0</div>
<div class="line">}</div>
</div><!-- fragment --><p> E.g. the JSON message</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;time&quot; : {</div>
<div class="line">        &quot;start&quot; : 5,</div>
<div class="line">        &quot;end&quot; : 10</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>is rendered by the above <code>mapping_template</code> as <b>5 to 11pm</b>. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sat May 3 2025 13:36:53 for MQTTSuite by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
