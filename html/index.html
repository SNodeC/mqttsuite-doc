<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MQTTSuite: MQTTSuite</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">var page_layout=1;</script>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra-style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="side-nav" class="ui-resizable side-nav-resizable"><!-- do not remove this div, it is closed by doxygen! -->
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">MQTTSuite
   </div>
  </td>
 </tr>
   <tr><td colspan="2">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect" class="search-icon" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()"><span class="search-icon-dropdown"></span></span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><div id="MSearchCloseImg" class="close-icon"></div></a>
          </span>
        </div>
</td></tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
</div><!-- top -->
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('index.html','',''); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search',true);
});
</script>
<div id="main-nav"></div>
<div id="container"><div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">MQTTSuite </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a></p>
<p align="center"></p>
<p><img src="./docs/assets/README/Logo-New-Full.png" alt="" style="width: 50%;" class="inline"/></p>
<hr  />
<h1 class="doxsection"><a class="anchor" id="overview"></a>
Overview</h1>
<p>The <a href="https://snodec.github.io/mqttsuite-doc/html/index.html"><b>MQTTSuite</b></a> is a lightweight, production-ready MQTT 3.1.1 integration system composed of four focused applications</p>
<p><b>MQTTBroker</b></p>
<ul>
<li><em>Role:</em> Full MQTT broker (MQTT 3.1.1)</li>
<li><em>Highlights:</em> Can simultaneously act as <em>MQTTIntegrator</em>; built-in Web UI (live clients)</li>
</ul>
<p><b>MQTTIntegrator</b></p>
<ul>
<li><em>Role:</em> Mapping-driven IoT translator for modelling IoT scenarios</li>
<li><em>Highlights:</em> Subscribes → transforms (topics and messages via INJA templates or static mappings) → republishes; wildcards (<span class="tt">+</span>, <span class="tt">#</span>); fine-grained QoS/retain</li>
</ul>
<p><b>MQTTBridge</b></p>
<ul>
<li><em>Role:</em> Pure client-side bridge</li>
<li><em>Highlights:</em> Multiple logical bridges; connects to multiple brokers per bridge; selectively bridges topics among them; loop prevention</li>
</ul>
<p><b>MQTTCli</b></p>
<ul>
<li><em>Role:</em> Command-line client</li>
<li><em>Highlights:</em> Subscribe to topics and/or publish messages</li>
</ul>
<p>powered by <a href="https://github.com/SNodeC/snode.c"><b>SNode.C</b></a>, a single-threaded, single-tasking C++ networking framework. All of these applications have built-in support for encrypted and unencrypted stream sockets and WebSockets over IPv4/IPv6 and UNIX domain sockets.</p>
<p>Thanks to its small footprint, MQTTSuite is especially suitable for resource-constrained systems (embedded Linux, routers, SBCs).</p>
<p>Because these are fully featured tools, they can also be used as foundations for developing specialized MQTT applications. One example is extending <em>MQTTCli</em> to persist incoming JSON messages in a database.</p>
<h2 class="doxsection"><a class="anchor" id="license"></a>
License</h2>
<p><b>MQTTSuite</b> is dual-licensed under <b>MIT</b> and <b>GPL-3.0-or-later</b>. You may choose either license when using the framework.</p>
<p><span class="tt">SPDX-License-Identifier: MIT OR GPL-3.0-or-later</span></p>
<blockquote class="doxtable">
<p>Note: MQTTSuite applications are built on top of SNode.C and follow the respective licensing terms of their repositories and bundled libraries. </p>
</blockquote>
<h2 class="doxsection"><a class="anchor" id="copyright"></a>
Copyright</h2>
<p>Volker Christian (<a href="#" onclick="location.href='mai'+'lto:'+'me@'+'vc'+'hri'+'st'+'.at'; return false;">me@vchrist.at</a>, <a href="#" onclick="location.href='mai'+'lto:'+'vol'+'ke'+'r.c'+'hr'+'ist'+'ia'+'n@f'+'h-'+'hag'+'en'+'ber'+'g.'+'at'; return false;">volker.christian@fh-hagenberg.at</a>)</p>
<hr  />
<h1 class="doxsection"><a class="anchor" id="table-of-content"></a>
Table of Content</h1>
<ul>
<li><a class="el" href="#overview">Overview</a><ul>
<li><a class="el" href="#license">License</a></li>
<li><a class="el" href="#copyright">Copyright</a></li>
</ul>
</li>
<li><a class="el" href="#table-of-content">Table of Content</a></li>
<li><a class="el" href="#installation">Installation</a><ul>
<li><a class="el" href="#supported-systems--hardware">Supported Systems &amp; Hardware</a></li>
<li><a class="el" href="#minimum-required-compiler-versions">Minimum Required Compiler Versions</a></li>
<li><a class="el" href="#requirements--dependencies">Requirements &amp; Dependencies</a><ul>
<li><a class="el" href="#tools">Tools</a><ul>
<li><a class="el" href="#mandatory">Mandatory</a></li>
<li><a class="el" href="#optional-useful-for-developmentqa">Optional (useful for development/QA)</a></li>
</ul>
</li>
<li><a class="el" href="#mandatory-libraries-and-frameworks">Mandatory Libraries and Frameworks</a><ul>
<li><a class="el" href="#frameworks">Frameworks</a></li>
<li><a class="el" href="#libraries">Libraries</a></li>
</ul>
</li>
<li><a class="el" href="#bundled-no-separate-installation-required">Bundled (no separate installation required)</a></li>
</ul>
</li>
<li><a class="el" href="#installation-on-debian-style-systems-x86-64-arm">Installation on Debian-Style Systems (x86-64, ARM)</a><ul>
<li><a class="el" href="#install-snodec">Install SNode.C</a></li>
<li><a class="el" href="#install-system-packages">Install system packages</a></li>
<li><a class="el" href="#build--install-mqttsuite">Build &amp; Install MQTTSuite</a></li>
</ul>
</li>
<li><a class="el" href="#deployment-on-openwrt">Deployment on OpenWrt</a><ul>
<li><a class="el" href="#choose--download-an-sdk">Choose &amp; download an SDK</a></li>
<li><a class="el" href="#patch-the-sdk-to-integrate-the-snodec-feed">Patch the SDK to integrate the SNode.C feed</a></li>
<li><a class="el" href="#install-the-mqttsuite-package-definition-and-its-dependencies">Install the MQTTSuite package definition and its dependencies</a></li>
<li><a class="el" href="#configure-the-sdk">Configure the SDK</a></li>
<li><a class="el" href="#cross-compile-mqttsuite">Cross-compile MQTTSuite</a></li>
<li><a class="el" href="#deploy-mqttsuite">Deploy MQTTSuite</a></li>
</ul>
</li>
<li><a class="el" href="#post-install-tips">Post-Install Tips</a></li>
</ul>
</li>
<li><a class="el" href="#mqttbroker">MQTTBroker</a><ul>
<li><a class="el" href="#connection-instances-of-default-builds-of-mqttbroker">Connection instances of default builds of <em>MQTTBroker</em></a></li>
<li><a class="el" href="#configuration">Configuration</a></li>
<li><a class="el" href="#notes">Notes</a></li>
<li><a class="el" href="#quick-start-recommended-flow">Quick Start (Recommended Flow)</a><ul>
<li><a class="el" href="#disable-all-but-the-in-mqtt-instance">Disable all but the in-mqtt instance</a></li>
<li><a class="el" href="#start-a-plain-mqtt-listener-on-tcpipv4">Start a plain MQTT listener on TCP/IPv4</a></li>
<li><a class="el" href="#add-a-persistent-session-store-survives-restarts">Add a persistent session store (survives restarts)</a></li>
<li><a class="el" href="#enable-the-web-interface-http">Enable the Web Interface (HTTP)</a></li>
<li><a class="el" href="#persist-your-configuration-using--w-so-you-dont-repeat-flags">Persist your configuration using -w (so you don’t repeat flags)</a></li>
<li><a class="el" href="#optional-embed-the-integrator--after-the-configuration-has-been-saved">(Optional) Embed the integrator (after the configuration has been saved)</a></li>
<li><a class="el" href="#for-development-only-use-custom-html-templates-for-the-web-ui-after-the-configuration-has-been-saved">(For development only) Use custom HTML templates for the Web UI (after the configuration has been saved)</a></li>
</ul>
</li>
<li><a class="el" href="#supported-transports">Supported Transports</a><ul>
<li><a class="el" href="#mqtt-over-tcpip">MQTT over TCP/IP</a></li>
<li><a class="el" href="#mqtt-over-unix-domain-sockets">MQTT over UNIX Domain Sockets</a></li>
<li><a class="el" href="#mqtt-over-websockets">MQTT over WebSockets</a></li>
<li><a class="el" href="#mqtt-over-unix-domain-websockets">MQTT over UNIX Domain WebSockets</a></li>
</ul>
</li>
<li><a class="el" href="#web-interface">Web Interface</a><ul>
<li><a class="el" href="#web-interface-over-tcpip">Web Interface over TCP/IP</a></li>
<li><a class="el" href="#web-interface-over-unix-domain-sockets">Web Interface over UNIX Domain Sockets</a></li>
</ul>
</li>
<li><a class="el" href="#additions--field-tested-guidance">Additions &amp; Field-Tested Guidance</a><ul>
<li><a class="el" href="#quick-tls-checklist-for-mqtttcp-and-mqtt-over-websockets">Quick TLS checklist for MQTT(TCP) and MQTT over WebSockets</a><ul>
<li><a class="el" href="#example-tcptls">Example (TCP/TLS):</a></li>
<li><a class="el" href="#example-websocketstls">Example (WebSockets/TLS):</a></li>
</ul>
</li>
<li><a class="el" href="#making-configuration-persistent-recommended">Making configuration persistent (recommended)</a></li>
<li><a class="el" href="#websockets-specifics-that-often-trip-clients">WebSockets specifics that often trip clients</a></li>
<li><a class="el" href="#quick-sanity-checks-with-common-tools">Quick sanity checks with common tools</a></li>
<li><a class="el" href="#quick-sanity-checks-with-mqttsuites-command-line-tool">Quick sanity checks with MQTTSuites command line tool</a></li>
<li><a class="el" href="#notes-for-unix-domain-sockets">Notes for UNIX domain sockets</a></li>
<li><a class="el" href="#embedded-mqttintegrator-when---mqtt-mapping-file-is-provided">Embedded MQTTIntegrator (when --mqtt-mapping-file is provided)</a></li>
<li><a class="el" href="#extending-transports">Extending transports</a></li>
<li><a class="el" href="#diagnostics-hardening--tips">Diagnostics, hardening &amp; tips</a></li>
</ul>
</li>
<li><a class="el" href="#protocol-version-note">Protocol version note</a></li>
<li><a class="el" href="#why-this-layout-works-well-in-production">Why this layout works well in production</a></li>
</ul>
</li>
<li><a class="el" href="#mqtt-mapping-description">MQTT Mapping Description</a><ul>
<li><a class="el" href="#purpose">Purpose</a></li>
<li><a class="el" href="#top-level-structure">Top-Level Structure</a><ul>
<li><a class="el" href="#connection-options-summary">connection options (summary)</a></li>
<li><a class="el" href="#the-mapping-object-big-picture">The mapping Object (big picture)</a><ul>
<li><a class="el" href="#minimal-shapes">Minimal shapes</a></li>
<li><a class="el" href="#wildcard-examples">Wildcard examples</a></li>
<li><a class="el" href="#a-more-complex-hierarchy">A more complex hierarchy</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="el" href="#subscriptions--translation-rules">Subscriptions &amp; Translation Rules</a></li>
<li><a class="el" href="#mapping-sections">Mapping Sections</a><ul>
<li><a class="el" href="#static-mapping">static mapping</a></li>
<li><a class="el" href="#value-mapping-template-scalar">value mapping (template, scalar)</a></li>
<li><a class="el" href="#json-mapping-template-object">json mapping (template, object)</a><ul>
<li><a class="el" href="#example-input">Example input</a></li>
<li><a class="el" href="#rendered-output--5-to-11pm">Rendered output → 5 to 11pm</a></li>
</ul>
</li>
<li><a class="el" href="#template-extras">Template extras</a></li>
</ul>
</li>
<li><a class="el" href="#optional-plugins">Optional: plugins</a></li>
<li><a class="el" href="#quick-start-recommended-flow-1">Quick Start (Recommended Flow)</a><ul>
<li><a class="el" href="#skeleton-mapping-file">Skeleton mapping file</a></li>
<li><a class="el" href="#add-a-concrete-subscription-with-a-simple-static-mapping">Add a concrete subscription with a simple static mapping</a></li>
<li><a class="el" href="#switch-to-a-template-mapping-when-you-need-logic">Switch to a template mapping when you need logic</a></li>
<li><a class="el" href="#validate-against-the-schema-example-with-ajv-cli">Validate against the schema (example with ajv-cli)</a></li>
<li><a class="el" href="#run-the-integrator-with-your-mapping">Run the integrator with your mapping</a></li>
</ul>
</li>
<li><a class="el" href="#field-tested-guidance">Field-Tested Guidance</a></li>
<li><a class="el" href="#schema-highlights">Schema Highlights</a></li>
<li><a class="el" href="#in-one-sentence">In one sentence</a></li>
</ul>
</li>
<li><a class="el" href="#mqttintegrator">MQTTIntegrator</a><ul>
<li><a class="el" href="#connection-instances-of-default-builds-of-mqttintegrator">Connection instances of default builds of <em>MQTTIntegrator</em></a></li>
<li><a class="el" href="#configuration-1">Configuration</a></li>
<li><a class="el" href="#notes-1">Notes</a></li>
<li><a class="el" href="#quick-start-recommended-flow-2">Quick Start (Recommended Flow)</a><ul>
<li><a class="el" href="#disable-all-but-the-in-mqtt-instance-1">Disable all but the in-mqtt instance</a></li>
<li><a class="el" href="#connect-to-a-plain-mqtt-broker-over-tcpipv4">Connect to a plain MQTT broker over TCP/IPv4</a></li>
<li><a class="el" href="#add-a-persistent-session-store-survives-restarts-1">Add a persistent session store (survives restarts)</a></li>
<li><a class="el" href="#attach-your-mapping-file-canonical-test-case-below">Attach your mapping file (canonical test case below)</a></li>
<li><a class="el" href="#persist-your-configuration-using--w">Persist your configuration using -w</a></li>
<li><a class="el" href="#optional-use-tls-mqtts-instead-of-plain-tcp">(Optional) Use TLS (MQTTS) instead of plain TCP</a></li>
<li><a class="el" href="#optional-use-websockets-wss">(Optional) Use WebSockets (WSS)</a></li>
<li><a class="el" href="#optional-use-unix-domain-websockets">(Optional) Use Unix Domain WebSockets</a></li>
</ul>
</li>
<li><a class="el" href="#supported-transports-1">Supported Transports</a><ul>
<li><a class="el" href="#mqtt-over-tcpip-1">MQTT over TCP/IP</a></li>
<li><a class="el" href="#mqtt-over-unix-domain-sockets-1">MQTT over UNIX Domain Sockets</a></li>
<li><a class="el" href="#mqtt-over-websockets-1">MQTT over WebSockets</a></li>
<li><a class="el" href="#mqtt-over-unix-domain-websockets-1">MQTT over UNIX Domain WebSockets</a></li>
<li><a class="el" href="#notes-2">Notes</a></li>
</ul>
</li>
<li><a class="el" href="#canonical-mapping--test-case">Canonical Mapping &amp; Test Case</a><ul>
<li><a class="el" href="#save-as-mapping-examplejson">Save as ~/mapping-example.json:</a></li>
<li><a class="el" href="#run-the-integrator-for-this-mapping-in-mqtt">Run the integrator for this mapping (in-mqtt):</a></li>
<li><a class="el" href="#persist-once">Persist once:</a></li>
<li><a class="el" href="#then-just-run">Then just run</a></li>
<li><a class="el" href="#verification">Verification</a></li>
</ul>
</li>
<li><a class="el" href="#behavior-aligned-with-the-mapping-description">Behavior aligned with the Mapping Description</a></li>
<li><a class="el" href="#additions--field-tested-guidance-1">Additions &amp; Field-Tested Guidance</a><ul>
<li><a class="el" href="#tls-checklist-for-client-connections-mqtts--wss--uds-wss">TLS checklist for client connections (MQTTS / WSS / UDS-WSS)</a><ul>
<li><a class="el" href="#example-tcptls-with-mutual-tls">Example (TCP/TLS) with mutual TLS:</a></li>
<li><a class="el" href="#example-websocketstls-1">Example (WebSockets/TLS):</a></li>
<li><a class="el" href="#example-unix-domain-websockets-tls-layered-on-the-ws-endpoint">Example (Unix Domain WebSockets, TLS layered on the WS endpoint):</a></li>
</ul>
</li>
<li><a class="el" href="#persist-once-workflow-recommended">Persist-once workflow (recommended)</a></li>
<li><a class="el" href="#websockets-specifics-that-often-trip-clients-1">WebSockets specifics that often trip clients</a></li>
<li><a class="el" href="#diagnostics-hardening--common-pitfalls">Diagnostics, hardening &amp; common pitfalls</a></li>
</ul>
</li>
<li><a class="el" href="#protocol-version-note-1">Protocol version note</a></li>
<li><a class="el" href="#why-this-layout-works-well-in-production-1">Why this layout works well in production</a></li>
</ul>
</li>
<li><a class="el" href="#mqttbridge">MQTTBridge</a><ul>
<li><a class="el" href="#quick-start-recommended-flow-3">Quick Start (Recommended Flow)</a><ul>
<li><a class="el" href="#create-a-minimal-bridge-configjson">Create a minimal bridge-config.json</a></li>
<li><a class="el" href="#run-the-bridge">Run the bridge:</a></li>
<li><a class="el" href="#verify-example">Verify (example):</a></li>
</ul>
</li>
<li><a class="el" href="#bridge-configuration-json">Bridge Configuration JSON</a><ul>
<li><a class="el" href="#overall-structure-at-a-glance">Overall Structure (at a glance)</a></li>
<li><a class="el" href="#elements-in-detail">Elements in Detail</a><ul>
<li><a class="el" href="#root-object">Root Object</a></li>
<li><a class="el" href="#bridge-each-item-in-bridges">bridge (each item in bridges)</a></li>
<li><a class="el" href="#broker-each-item-in-brokers">broker (each item in brokers)</a></li>
<li><a class="el" href="#mqtt-client-options">mqtt (client options)</a></li>
<li><a class="el" href="#topics-subscriptions-for-a-broker">topics (subscriptions for a broker)</a></li>
<li><a class="el" href="#network-transport-selection--addressing">network (transport selection + addressing)</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="el" href="#best-practices--validation-tips">Best Practices &amp; Validation Tips</a></li>
</ul>
</li>
<li><a class="el" href="#mqttcli">MQTTCli</a><ul>
<li><a class="el" href="#quick-start-recommended-flow-4">Quick Start (Recommended Flow)</a></li>
<li><a class="el" href="#command-structure">Command Structure</a></li>
<li><a class="el" href="#supported-transports-2">Supported Transports</a><ul>
<li><a class="el" href="#mqtt-over-tcpip-2">MQTT over TCP/IP</a></li>
<li><a class="el" href="#mqtt-over-unix-domain-sockets-2">MQTT over UNIX Domain Sockets</a></li>
<li><a class="el" href="#mqtt-over-websockets-2">MQTT over WebSockets</a></li>
<li><a class="el" href="#mqtt-over-unix-domain-websockets-2">MQTT over UNIX Domain WebSockets</a></li>
</ul>
</li>
<li><a class="el" href="#additions--field-tested-guidance-2">Additions &amp; Field-Tested Guidance</a><ul>
<li><a class="el" href="#tls-quick-checklist">TLS quick checklist</a></li>
<li><a class="el" href="#websockets-specifics">WebSockets specifics</a></li>
<li><a class="el" href="#unix-domain-sockets">UNIX domain sockets</a></li>
<li><a class="el" href="#persist-once-optional">Persist once (optional)</a></li>
</ul>
</li>
<li><a class="el" href="#handy-patterns">Handy Patterns</a></li>
<li><a class="el" href="#notes-3">Notes</a></li>
</ul>
</li>
</ul>
<hr  />
<h1 class="doxsection"><a class="anchor" id="installation"></a>
Installation</h1>
<p>Installation is straightforward:</p>
<ol type="1">
<li><b>Install the SNode.C framework.</b></li>
<li><b>Install required tools and libraries.</b></li>
<li><b>Clone, build, and install MQTTSuite.</b></li>
</ol>
<p>Use the detailed platform-specific instructions below.</p>
<h2 class="doxsection"><a class="anchor" id="supported-systems--hardware"></a>
Supported Systems &amp; Hardware</h2>
<p>Development is primarily on <b>Debian Sid</b>; since <b>Debian Bookworm</b> it also builds cleanly on Debian stable. With the required tools and libraries installed, it should compile on most Linux distributions.</p>
<p>Known good targets:</p>
<ul>
<li><b>x86-64</b> (PC/servers)</li>
<li><b>ARM 32/64-bit</b> (e.g., Raspberry Pi 3/4/5)</li>
<li><b>OpenWrt</b> 23.05.0 and later (all architectures)</li>
<li><b>Android</b> via <a href="https://termux.dev/en/">Termux</a> <em>(documentation in preparation)</em></li>
</ul>
<h2 class="doxsection"><a class="anchor" id="minimum-required-compiler-versions"></a>
Minimum Required Compiler Versions</h2>
<p>SNode.C and MQTTSuite leverage C++20 features; therefore recent compilers are required.</p>
<ul>
<li><b>GCC ≥ 12.2</b></li>
<li><b>Clang ≥ 13.0</b></li>
</ul>
<p>Either toolchain is supported.</p>
<h2 class="doxsection"><a class="anchor" id="requirements--dependencies"></a>
Requirements &amp; Dependencies</h2>
<p>Some tools and libraries must be present. A few libraries are bundled within MQTTSuite.</p>
<h3 class="doxsection"><a class="anchor" id="tools"></a>
Tools</h3>
<h4 class="doxsection"><a class="anchor" id="mandatory"></a>
Mandatory</h4>
<ul>
<li><span class="tt">git</span> — <a href="https://git-scm.com/">https://git-scm.com/</a></li>
<li><span class="tt">cmake</span> — <a href="https://cmake.org/">https://cmake.org/</a></li>
<li><span class="tt">make</span> — <a href="https://www.gnu.org/software/make/">https://www.gnu.org/software/make/</a> <b>or</b></li>
<li><span class="tt">ninja</span> — <a href="https://ninja-build.org/">https://ninja-build.org/</a></li>
<li><span class="tt">g++</span> — <a href="https://gcc.gnu.org/">https://gcc.gnu.org/</a> <b>or</b></li>
<li><span class="tt">clang</span> — <a href="https://clang.llvm.org/">https://clang.llvm.org/</a></li>
<li><span class="tt">pkg-config</span> — <a href="https://www.freedesktop.org/wiki/Software/pkg-config/">https://www.freedesktop.org/wiki/Software/pkg-config/</a></li>
</ul>
<h4 class="doxsection"><a class="anchor" id="optional-useful-for-developmentqa"></a>
Optional (useful for development/QA)</h4>
<ul>
<li><span class="tt">iwyu</span> — <a href="https://include-what-you-use.org/">https://include-what-you-use.org/</a></li>
<li><span class="tt">clang-format</span> — <a href="https://clang.llvm.org/docs/ClangFormat.html">https://clang.llvm.org/docs/ClangFormat.html</a></li>
<li><span class="tt">cmake-format</span> — <a href="https://cmake-format.readthedocs.io/">https://cmake-format.readthedocs.io/</a></li>
<li><span class="tt">doxygen</span> — <a href="https://www.doxygen.nl/">https://www.doxygen.nl/</a></li>
</ul>
<h3 class="doxsection"><a class="anchor" id="mandatory-libraries-and-frameworks"></a>
Mandatory Libraries and Frameworks</h3>
<h4 class="doxsection"><a class="anchor" id="frameworks"></a>
Frameworks</h4>
<ul>
<li><b>SNode.C</b> – Simple NODE in C++: <a href="https://github.com/SNodeC/snode.c">https://github.com/SNodeC/snode.c</a></li>
</ul>
<h4 class="doxsection"><a class="anchor" id="libraries"></a>
Libraries</h4>
<ul>
<li><b>libfmt</b> (≥ 11.0.0) development files — <a href="https://github.com/fmtlib/fmt">https://github.com/fmtlib/fmt</a></li>
</ul>
<h3 class="doxsection"><a class="anchor" id="bundled-no-separate-installation-required"></a>
Bundled (no separate installation required)</h3>
<ul>
<li><b>JSON Schema Validator for Modern C++</b> — <a href="https://github.com/pboettch/json-schema-validator">https://github.com/pboettch/json-schema-validator</a></li>
<li><b>INJA</b>: A Template Engine for Modern C++ — <a href="https://github.com/pantor/inja">https://github.com/pantor/inja</a></li>
</ul>
<h2 class="doxsection"><a class="anchor" id="installation-on-debian-style-systems-x86-64-arm"></a>
Installation on Debian-Style Systems (x86-64, ARM)</h2>
<h3 class="doxsection"><a class="anchor" id="install-snodec"></a>
Install SNode.C</h3>
<p>Follow the SNode.C installation guide: <br  />
 <a href="https://github.com/SNodeC/snode.c?tab=readme-ov-file#installation">https://github.com/SNodeC/snode.c?tab=readme-ov-file#installation</a></p>
<h3 class="doxsection"><a class="anchor" id="install-system-packages"></a>
Install system packages</h3>
<div class="fragment"><div class="line">sudo apt update</div>
<div class="line">sudo apt install libfmt-dev</div>
<div class="line"># Recommended for building:</div>
<div class="line"># sudo apt install git cmake build-essential ninja-build pkg-config</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="build--install-mqttsuite"></a>
Build &amp; Install MQTTSuite</h3>
<div class="fragment"><div class="line">mkdir mqttsuite</div>
<div class="line">cd mqttsuite</div>
<div class="line">git clone --recurse-submodules https://github.com/SNodeC/mqttsuite.git</div>
<div class="line">mkdir build</div>
<div class="line">cd build</div>
<div class="line">cmake ../mqttsuite        # optionally: -G Ninja -DCMAKE_BUILD_TYPE=Release</div>
<div class="line">make -j&quot;$(nproc)&quot;         # or: ninja</div>
<div class="line">sudo make install         # or: sudo ninja install</div>
<div class="line">sudo ldconfig</div>
</div><!-- fragment --><blockquote class="doxtable">
<p>Tip: Use all CPU threads (<span class="tt">-j$(nproc)</span>) to speed up the build—especially useful on SBCs. </p>
</blockquote>
<h2 class="doxsection"><a class="anchor" id="deployment-on-openwrt"></a>
Deployment on OpenWrt</h2>
<p><em>Assumptions:</em> You have <b>SSH</b> and <b>SFTP</b> access to the router, and WAN connectivity is configured.</p>
<blockquote class="doxtable">
<p>You <b>do not</b> install SNode.C manually; the OpenWrt build will pull it in automatically via the feed. </p>
</blockquote>
<p>High-level steps:</p>
<ol type="1">
<li><b>Choose and download an OpenWrt SDK</b></li>
<li><b>Patch the SDK to add the SNode.C (snodec) feed</b> (contains the MQTTSuite feed)</li>
<li><b>Install the MQTTSuite package and dependencies</b></li>
<li><b>Configure the SDK</b></li>
<li><b>Cross-compile MQTTSuite</b></li>
<li><b>Deploy the resulting <span class="tt">.ipk</span> packages to the router</b></li>
</ol>
<h3 class="doxsection"><a class="anchor" id="choose--download-an-sdk"></a>
Choose &amp; download an SDK</h3>
<p>Download an SDK (23.05.0-rc1 or later) from the OpenWrt download site and extract it to <span class="tt">&lt;DIR&gt;</span>.</p>
<p>Example (Netgear MR8300, IPQ4019):</p>
<div class="fragment"><div class="line">cd &lt;DIR&gt;</div>
<div class="line">wget -qO - https://downloads.openwrt.org/releases/23.05.0-rc2/targets/ipq40xx/generic/openwrt-sdk-23.05.0-rc2-ipq40xx-generic_gcc-12.3.0_musl_eabi.Linux-x86_64.tar.xz | tar Jx</div>
</div><!-- fragment --><p>This creates an SDK directory like: <span class="tt">openwrt-sdk-&lt;version&gt;-&lt;arch&gt;-&lt;atype&gt;_&lt;compiler&gt;-&lt;cver&gt;_&lt;libc&gt;_&lt;abi&gt;.Linux-x86_64</span> → referred to as <span class="tt">&lt;SDK_DIR&gt;</span>.</p>
<p>For the example above:</p>
<ul>
<li><span class="tt">&lt;version&gt;</span> = 23.05.0-rc2</li>
<li><span class="tt">&lt;arch&gt;</span> = ipq40xx</li>
<li><span class="tt">&lt;atype&gt;</span> = generic</li>
<li><span class="tt">&lt;compiler&gt;</span> = gcc</li>
<li><span class="tt">&lt;cver&gt;</span> = 12.3.0</li>
<li><span class="tt">&lt;libc&gt;</span> = musl</li>
<li><span class="tt">&lt;abi&gt;</span> = eabi</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="patch-the-sdk-to-integrate-the-snodec-feed"></a>
Patch the SDK to integrate the SNode.C feed</h3>
<p>This feed contains also the definitions for compiling MQTTSuite.</p>
<div class="fragment"><div class="line">cd &lt;SDK_DIR&gt;</div>
<div class="line">echo &quot;src-git snodec https://github.com/SNodeC/OpenWRT&quot; &gt;&gt; feeds.conf.default</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="install-the-mqttsuite-package-definition-and-its-dependencies"></a>
Install the MQTTSuite package definition and its dependencies</h3>
<div class="fragment"><div class="line">cd &lt;SDK_DIR&gt;</div>
<div class="line">./scripts/feeds update base packages snodec    # only these feeds are needed</div>
<div class="line">./scripts/feeds install mqttsuite</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="configure-the-sdk"></a>
Configure the SDK</h3>
<div class="fragment"><div class="line">cd &lt;SDK_DIR&gt;</div>
<div class="line">make defconfig</div>
</div><!-- fragment --><p>You can keep defaults. To customize SNode.C/MQTTSuite options:</p>
<div class="fragment"><div class="line">cd &lt;SDK_DIR&gt;</div>
<div class="line">make menuconfig</div>
<div class="line"># Navigate: Network -&gt; SNode.C</div>
<div class="line">#       or: Network -&gt; MQTTSuite</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="cross-compile-mqttsuite"></a>
Cross-compile MQTTSuite</h3>
<div class="fragment"><div class="line">cd &lt;SDK_DIR&gt;</div>
<div class="line">make package/mqttsuite/compile -j&quot;$(nproc)&quot;</div>
</div><!-- fragment --><p>What happens:</p>
<ol type="1">
<li>Feeds and package metadata are refreshed locally.</li>
<li>All direct/indirect dependencies are fetched and built as needed.</li>
<li>MQTTSuite is cloned and cross-compiled.</li>
</ol>
<blockquote class="doxtable">
<p>After building, the <span class="tt">.ipk</span> packages for <b>MQTTSuite</b> and <b>SNode.C</b> are usually found under: <span class="tt">&lt;SDK_DIR&gt;/bin/packages/&lt;architecture&gt;/snodec/</span> </p>
</blockquote>
<h3 class="doxsection"><a class="anchor" id="deploy-mqttsuite"></a>
Deploy MQTTSuite</h3>
<p>Copy and install the generated packages onto the router:</p>
<div class="fragment"><div class="line">cd &lt;SDK_DIR&gt;/bin/packages/&lt;architecture&gt;/snodec</div>
<div class="line">sftp root@&lt;router-ip&gt;</div>
<div class="line">cd /tmp</div>
<div class="line">put snode.c*.ipk</div>
<div class="line">put mqttsuite*.ipk</div>
<div class="line">exit</div>
<div class="line"> </div>
<div class="line">ssh root@&lt;router-ip&gt;</div>
<div class="line">cd /tmp</div>
<div class="line">opkg install snode.c*.ipk mqttsuite*.ipk   # add --force-reinstall to overwrite same version</div>
<div class="line">exit</div>
</div><!-- fragment --><blockquote class="doxtable">
<p>On first installation you may see errors about missing dependencies from the base OpenWrt repos. Install those with <span class="tt">opkg</span> and rerun the <span class="tt">opkg install</span> for MQTTSuite/SNode.C. </p>
</blockquote>
<p>During package installation, a new <b>UNIX group</b> (with member <span class="tt">root</span>) is created and used for managing config, log, and PID files. <br  />
 <b>Note:</b> log out and log in again to activate the new group membership.</p>
<h2 class="doxsection"><a class="anchor" id="post-install-tips"></a>
Post-Install Tips</h2>
<ul>
<li><b>Persist-once workflow:</b> All MQTTSuite applications support <span class="tt">--write-config</span> / <span class="tt">-w</span>. Start once with explicit flags, verify, then run with no flags.</li>
<li><b>Use UNIX domain sockets</b> for same-host integrations; they reduce overhead and surface area.</li>
<li><b>TLS everywhere off-host:</b> Use TLS (and client auth where appropriate) when crossing untrusted networks.</li>
<li><b>Parallel builds:</b> Always use <span class="tt">-j$(nproc)</span> (or Ninja) to accelerate compiles.</li>
</ul>
<hr  />
<h1 class="doxsection"><a class="anchor" id="mqttbroker"></a>
MQTTBroker</h1>
<p>The <em>MQTTBroker</em> is the central broker of the <b>MQTTSuite</b> and supports multiple connection instances across several transport protocols. Additional transports (e.g., Bluetooth) can be added in the <a href="https://github.com/SNodeC/mqttsuite/blob/master/mqttbroker/mqttbroker.cpp"><span class="tt">mqttbroker.cpp</span></a> source code.</p>
<h2 class="doxsection"><a class="anchor" id="connection-instances-of-default-builds-of-mqttbroker"></a>
Connection instances of default builds of <em>MQTTBroker</em></h2>
<ul>
<li><span class="tt">in-mqtt</span>: MQTT over IPv4</li>
<li><span class="tt">in-mqtts</span>: MQTTS over IPv4</li>
<li><span class="tt">in6-mqtt</span>: MQTT over IPv6</li>
<li><span class="tt">in6-mqtts</span>: MQTTS over IPv6</li>
<li><span class="tt">un-mqtt</span>: MQTT over Unix Domain Sockets</li>
<li><span class="tt">un-mqtts</span>: MQTTS over Unix Domain Sockets</li>
<li><span class="tt">in-http</span>: Web Interface and MQTT over WS via IPv4</li>
<li><span class="tt">in-https</span>: Web Interface and MQTTS over WSS over IPv4</li>
<li><span class="tt">in6-http</span>: Web Interface and MQTT over WS via IPv6</li>
<li><span class="tt">in6-https</span>: Web Interface and MQTTS over WSS via IPv6</li>
<li><span class="tt">un-http</span>: Web Interface and MQTT over WS via Unix Domain Sockets</li>
<li><span class="tt">un-https</span>: Web Interface and MQTTS over WSS via Unix Domain Sockets</li>
</ul>
<p>One can control which instances are built by enabling or disabling them through the available <span class="tt">cmake</span> options.</p>
<h2 class="doxsection"><a class="anchor" id="configuration"></a>
Configuration</h2>
<p>All aspects—such as port numbers, UNIX <em>sun</em> paths, and per-listener options—are configurable via the <a href="https://github.com/SNodeC/snode.c?tab=readme-ov-file#configuration">SNode.C configuration system</a>. You can set options in code, on the command line, or by using a configuration file.</p>
<p>If encrypted access is required, <a href="https://github.com/SNodeC/snode.c?tab=readme-ov-file#ssltls-configuration-section-tls">suitable certificates need to be provided</a>.</p>
<h2 class="doxsection"><a class="anchor" id="notes"></a>
Notes</h2>
<ul>
<li><b>Persistent sessions:</b> Configure a <em>session store</em> if you want client sessions to survive broker restarts by adding the command-line option <br  />
 <span class="tt">--mqtt-session-store &lt;path-to-session-store-file&gt;</span>.</li>
<li><b>Embedded integrator:</b> If the MQTTBroker should also act as an integrated <b>MQTTIntegrator</b>, provide a <em><a class="el" href="#mqtt-mapping-description">mapping description file</a></em> via <br  />
 <span class="tt">--mqtt-mapping-file &lt;path-to-mqtt-mapping-file.json&gt;</span>.</li>
<li><b>Web UI templates:</b> The path to the HTML templates for the MQTTBroker Web Interface can be set with <br  />
 <span class="tt">--html-dir &lt;dir-of-html-templates&gt;</span>. The default directory <span class="tt">/var/www/mqttsuite/mqttbroker</span> is already configured in <a href="https://github.com/SNodeC/mqttsuite/blob/master/mqttbroker/mqttbroker.cpp"><span class="tt">mqttbroker.cpp</span></a>.</li>
<li><b>Persisting options:</b> All three options above can be made <em>persistent</em> by storing their values in a configuration file; append <span class="tt">--write-config</span> or <span class="tt">-w</span> to the command line.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="quick-start-recommended-flow"></a>
Quick Start (Recommended Flow)</h2>
<p>Explore the <em>MQTTBroker</em> command line by using <span class="tt">mqttbroker --help</span>.</p>
<div class="fragment"><div class="line">mqttbroker --help</div>
<div class="line"> </div>
<div class="line">Configuration for Application &#39;mqttbroker&#39; </div>
<div class="line"> </div>
<div class="line">Usage: mqttbroker [OPTIONS] [INSTANCES [--help]]</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">Application Options:</div>
<div class="line">  --mqtt-mapping-file [path] </div>
<div class="line">       MQTT mapping file (json format) for integration </div>
<div class="line">  --mqtt-session-store [path] </div>
<div class="line">       Path to file for the persistent session store </div>
<div class="line">  --html-dir [path] [/usr/local/var/www/mqttsuite/mqttbroker] </div>
<div class="line">       Path to html source directory </div>
<div class="line"> </div>
<div class="line">Options (nonpersistent):</div>
<div class="line">  -c, --config-file configfile:NOT DIR [/home/voc/.config/snode.c/mqttbroker.conf] </div>
<div class="line">       Read a config file </div>
<div class="line">  -w, --write-config [configfile]:NOT DIR [/home/voc/.config/snode.c/mqttbroker.conf] </div>
<div class="line">       Write config file and exit </div>
<div class="line">  -k, --kill </div>
<div class="line">       Kill running daemon </div>
<div class="line">  -i, --instance-alias instance=instance_alias [instance=instance_alias [...]] </div>
<div class="line">       Make an instance also known as an alias in configuration files </div>
<div class="line">  -s, --show-config </div>
<div class="line">       Show current configuration and exit </div>
<div class="line">  --command-line{standard}={standard,required,full,default} </div>
<div class="line">       Print a command line </div>
<div class="line">       standard (default): View all non-default and required options </div>
<div class="line">       required: View required options only </div>
<div class="line">       full: View the full set of options with their default or </div>
<div class="line">       configured values </div>
<div class="line">       default: View the full set of options with their default values </div>
<div class="line">  --version </div>
<div class="line">       Framework version </div>
<div class="line">  -h{exact}, --help{exact}={standard,exact,expanded} {exact} </div>
<div class="line">       Print help message and exit </div>
<div class="line"> </div>
<div class="line">Options (persistent):</div>
<div class="line">  -l, --log-level level:INT in [0 - 6] [4] </div>
<div class="line">       Log level </div>
<div class="line">  -v, --verbose-level level:INT in [0 - 10] [2] </div>
<div class="line">       Verbose level </div>
<div class="line">  -q{true}, -u{false}, --quiet{true}={true,false} [false] </div>
<div class="line">       Quiet mode </div>
<div class="line">  --log-file logfile:NOT DIR [/home/voc/.local/log/snode.c/mqttbroker.log] </div>
<div class="line">       Log file path </div>
<div class="line">  -e{true}, -n{false}, --enforce-log-file{true}={true,false} [false] </div>
<div class="line">       Enforce writing of logs to file for foreground applications </div>
<div class="line">  -d{true}, -f{false}, --daemonize{true}={true,false} [false] </div>
<div class="line">       Start application as daemon </div>
<div class="line">  --user-name username [voc] Needs: --daemonize </div>
<div class="line">       Run daemon under specific user permissions </div>
<div class="line">  --group-name groupname [voc] Needs: --daemonize </div>
<div class="line">       Run daemon under specific group permissions </div>
<div class="line"> </div>
<div class="line">Instances:</div>
<div class="line">  in-mqtt</div>
<div class="line">       Configuration for server instance &#39;in-mqtt&#39; </div>
<div class="line">  in-mqtts</div>
<div class="line">       Configuration for server instance &#39;in-mqtts&#39; </div>
<div class="line">  in6-mqtt</div>
<div class="line">       Configuration for server instance &#39;in6-mqtt&#39; </div>
<div class="line">  in6-mqtts</div>
<div class="line">       Configuration for server instance &#39;in6-mqtts&#39; </div>
<div class="line">  un-mqtt</div>
<div class="line">       Configuration for server instance &#39;un-mqtt&#39; </div>
<div class="line">  un-mqtts</div>
<div class="line">       Configuration for server instance &#39;un-mqtts&#39; </div>
<div class="line">  in-http</div>
<div class="line">       Configuration for server instance &#39;in-http&#39; </div>
<div class="line">  in-https</div>
<div class="line">       Configuration for server instance &#39;in-https&#39; </div>
<div class="line">  in6-http</div>
<div class="line">       Configuration for server instance &#39;in6-http&#39; </div>
<div class="line">  in6-https</div>
<div class="line">       Configuration for server instance &#39;in6-https&#39; </div>
<div class="line">  un-http</div>
<div class="line">       Configuration for server instance &#39;un-http&#39; </div>
<div class="line">  un-https</div>
<div class="line">       Configuration for server instance &#39;un-https&#39; </div>
<div class="line"> </div>
<div class="line">Application &#39;mqttbroker&#39; powered by SNode.C </div>
<div class="line">(C) 2020-2025 Volker Christian &lt;me@vchrist.at&gt; </div>
<div class="line">https://github.com/SNodeC/snode.c</div>
</div><!-- fragment --><p>This help output outlines the various connection instances provided by the application: <span class="tt">in-mqtt</span>, <span class="tt">in-mqtts</span>, <span class="tt">in6-mqtt</span>, <span class="tt">in6-mqtts</span>, <span class="tt">un-mqtt</span>, <span class="tt">un-mqtts</span>, <span class="tt">in-http</span>, <span class="tt">in-https</span>, <span class="tt">in6-http</span>, <span class="tt">in6-https</span>, <span class="tt">un-http</span> and <span class="tt">un-https</span>.</p>
<p>All of these are enabled (active) by default and can be selectively disabled.</p>
<h3 class="doxsection"><a class="anchor" id="disable-all-but-the-in-mqtt-instance"></a>
Disable all but the <span class="tt">in-mqtt</span> instance</h3>
<div class="fragment"><div class="line">mqttbroker in-mqtts --disabled</div>
<div class="line">           in6-mqtt --disabled</div>
<div class="line">           in6-mqtts -disabled</div>
<div class="line">           un-mqtt --disabled</div>
<div class="line">           un-mqtts --disabled</div>
<div class="line">           in-http --disabled</div>
<div class="line">           in-https --disabled</div>
<div class="line">           in6-http --disabled</div>
<div class="line">           in6-https --disabled</div>
<div class="line">           un-http --disabled</div>
<div class="line">           un-https --disabled</div>
<div class="line">           -w</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="start-a-plain-mqtt-listener-on-tcpipv4"></a>
Start a plain MQTT listener on TCP/IPv4</h3>
<div class="fragment"><div class="line">mqttbroker in-mqtt \</div>
<div class="line">               local --host 0.0.0.0 \</div>
<div class="line">                     --port 1883</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="add-a-persistent-session-store-survives-restarts"></a>
Add a persistent session store (survives restarts)</h3>
<div class="fragment"><div class="line">mqttbroker --mqtt-session-store /var/lib/mqttsuite/mqttbroker/session.store \</div>
<div class="line">           in-mqtt \</div>
<div class="line">               local --host 0.0.0.0 \</div>
<div class="line">                     --port 1883</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="enable-the-web-interface-http"></a>
Enable the Web Interface (HTTP)</h3>
<div class="fragment"><div class="line">mqttbroker --mqtt-session-store /var/lib/mqttsuite/mqttbroker/session.store \</div>
<div class="line">           in-mqtt \</div>
<div class="line">               local --host 0.0.0.0 \</div>
<div class="line">                     --port 1883 </div>
<div class="line">           in-http \</div>
<div class="line">               --disabled=false \</div>
<div class="line">               local --host 0.0.0.0 \</div>
<div class="line">                     --port 8080</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="persist-your-configuration-using--w-so-you-dont-repeat-flags"></a>
Persist your configuration using <span class="tt">-w</span> (so you don’t repeat flags)</h3>
<div class="fragment"><div class="line">mqttbroker --mqtt-session-store /var/lib/mqttsuite/mqttbroker/session.store \</div>
<div class="line">           in-mqtt \</div>
<div class="line">               local --host 0.0.0.0 \</div>
<div class="line">                     --port 1883 </div>
<div class="line">           in-http \</div>
<div class="line">               --disabled=false \</div>
<div class="line">               local --host 0.0.0.0 \</div>
<div class="line">                     --port 8080 \</div>
<div class="line">           -w</div>
</div><!-- fragment --><p>From now on, a plain <span class="tt">mqttbroker</span> starts with the stored configuration.</p>
<h3 class="doxsection"><a class="anchor" id="optional-embed-the-integrator--after-the-configuration-has-been-saved"></a>
(Optional) Embed the integrator (after the configuration has been saved)</h3>
<div class="fragment"><div class="line">mqttbroker --mqtt-mapping-file /etc/mqttsuite/mappings/mqtt-mapping.json</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="for-development-only-use-custom-html-templates-for-the-web-ui-after-the-configuration-has-been-saved"></a>
(For development only) Use custom HTML templates for the Web UI (after the configuration has been saved)</h3>
<div class="fragment"><div class="line">mqttbroker --html-dir /var/www/mqttsuite/mqttbroker</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="supported-transports"></a>
Supported Transports</h2>
<h3 class="doxsection"><a class="anchor" id="mqtt-over-tcpip"></a>
MQTT over TCP/IP</h3>
<p>MQTT clients can connect via <em>IPv4</em> and <em>IPv6</em>, using both encrypted and unencrypted channels.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><a href="https://github.com/SNodeC/snode.c?tab=readme-ov-file#instance-configuration">Instance</a>  </th><th class="markdownTableHeadCenter">Protocol  </th><th class="markdownTableHeadCenter">Encryption  </th><th class="markdownTableHeadCenter">Local Port  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b><span class="tt">in-mqtt</span></b>  </td><td class="markdownTableBodyCenter">IPv4  </td><td class="markdownTableBodyCenter">No  </td><td class="markdownTableBodyCenter"><span class="tt">1883</span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b><span class="tt">in-mqtts</span></b>  </td><td class="markdownTableBodyCenter">IPv4  </td><td class="markdownTableBodyCenter">Yes  </td><td class="markdownTableBodyCenter"><span class="tt">8883</span>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b><span class="tt">in6-mqtt</span></b>  </td><td class="markdownTableBodyCenter">IPv6  </td><td class="markdownTableBodyCenter">No  </td><td class="markdownTableBodyCenter"><span class="tt">1883</span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b><span class="tt">in6-mqtts</span></b>  </td><td class="markdownTableBodyCenter">IPv6  </td><td class="markdownTableBodyCenter">Yes  </td><td class="markdownTableBodyCenter"><span class="tt">8883</span>  </td></tr>
</table>
<h3 class="doxsection"><a class="anchor" id="mqtt-over-unix-domain-sockets"></a>
MQTT over UNIX Domain Sockets</h3>
<p>For local (same-host) communication, the broker also supports UNIX domain sockets.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><a href="https://github.com/SNodeC/snode.c?tab=readme-ov-file#instance-configuration">Instance</a>  </th><th class="markdownTableHeadCenter">Encryption  </th><th class="markdownTableHeadNone">Local Sun Path  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b><span class="tt">un-mqtt</span></b>  </td><td class="markdownTableBodyCenter">No  </td><td class="markdownTableBodyNone"><span class="tt">/tmp/mqttbroker-un-mqtt</span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b><span class="tt">un-mqtts</span></b>  </td><td class="markdownTableBodyCenter">Yes  </td><td class="markdownTableBodyNone"><span class="tt">/tmp/mqttbroker-un-mqtts</span>  </td></tr>
</table>
<h3 class="doxsection"><a class="anchor" id="mqtt-over-websockets"></a>
MQTT over WebSockets</h3>
<p>Clients can connect via WebSockets over both <em>IPv4</em> and <em>IPv6</em>.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><a href="https://github.com/SNodeC/snode.c?tab=readme-ov-file#instance-configuration">Instance</a>  </th><th class="markdownTableHeadCenter">Protocol  </th><th class="markdownTableHeadCenter">Encryption  </th><th class="markdownTableHeadCenter">Local Port  </th><th class="markdownTableHeadCenter">Request Target  </th><th class="markdownTableHeadCenter">Sec-WebSocket-Protocol  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b><span class="tt">in-http</span></b>  </td><td class="markdownTableBodyCenter">IPv4  </td><td class="markdownTableBodyCenter">No  </td><td class="markdownTableBodyCenter"><span class="tt">8080</span>  </td><td class="markdownTableBodyCenter"><span class="tt">/</span> or <span class="tt">/ws</span>  </td><td class="markdownTableBodyCenter"><span class="tt"><a class="el" href="namespacemqtt.html">mqtt</a></span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b><span class="tt">in-https</span></b>  </td><td class="markdownTableBodyCenter">IPv4  </td><td class="markdownTableBodyCenter">Yes  </td><td class="markdownTableBodyCenter"><span class="tt">8088</span>  </td><td class="markdownTableBodyCenter"><span class="tt">/</span> or <span class="tt">/ws</span>  </td><td class="markdownTableBodyCenter"><span class="tt"><a class="el" href="namespacemqtt.html">mqtt</a></span>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b><span class="tt">in6-http</span></b>  </td><td class="markdownTableBodyCenter">IPv6  </td><td class="markdownTableBodyCenter">No  </td><td class="markdownTableBodyCenter"><span class="tt">8080</span>  </td><td class="markdownTableBodyCenter"><span class="tt">/</span> or <span class="tt">/ws</span>  </td><td class="markdownTableBodyCenter"><span class="tt"><a class="el" href="namespacemqtt.html">mqtt</a></span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b><span class="tt">in6-https</span></b>  </td><td class="markdownTableBodyCenter">IPv6  </td><td class="markdownTableBodyCenter">Yes  </td><td class="markdownTableBodyCenter"><span class="tt">8088</span>  </td><td class="markdownTableBodyCenter"><span class="tt">/</span> or <span class="tt">/ws</span>  </td><td class="markdownTableBodyCenter"><span class="tt"><a class="el" href="namespacemqtt.html">mqtt</a></span>  </td></tr>
</table>
<h3 class="doxsection"><a class="anchor" id="mqtt-over-unix-domain-websockets"></a>
MQTT over UNIX Domain WebSockets</h3>
<p>For local (same-host) communication, the broker also supports WebSockets over UNIX domain sockets.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><a href="https://github.com/SNodeC/snode.c?tab=readme-ov-file#instance-configuration">Instance</a>  </th><th class="markdownTableHeadCenter">Encryption  </th><th class="markdownTableHeadNone">Local Sun Path  </th><th class="markdownTableHeadCenter">Request Target  </th><th class="markdownTableHeadCenter">Sec-WebSocket-Protocol  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b><span class="tt">un-http</span></b>  </td><td class="markdownTableBodyCenter">No  </td><td class="markdownTableBodyNone"><span class="tt">/tmp/mqttbroker-un-http</span>  </td><td class="markdownTableBodyCenter"><span class="tt">/</span> or <span class="tt">/ws</span>  </td><td class="markdownTableBodyCenter"><span class="tt"><a class="el" href="namespacemqtt.html">mqtt</a></span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b><span class="tt">un-https</span></b>  </td><td class="markdownTableBodyCenter">Yes  </td><td class="markdownTableBodyNone"><span class="tt">/tmp/mqttbroker-un-https</span>  </td><td class="markdownTableBodyCenter"><span class="tt">/</span> or <span class="tt">/ws</span>  </td><td class="markdownTableBodyCenter"><span class="tt"><a class="el" href="namespacemqtt.html">mqtt</a></span>  </td></tr>
</table>
<h2 class="doxsection"><a class="anchor" id="web-interface"></a>
Web Interface</h2>
<h3 class="doxsection"><a class="anchor" id="web-interface-over-tcpip"></a>
Web Interface over TCP/IP</h3>
<p>The <em>MQTTBroker Web Interface</em> provides real-time visibility into active client connections.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><a href="https://github.com/SNodeC/snode.c?tab=readme-ov-file#instance-configuration">Instance</a>  </th><th class="markdownTableHeadCenter">Protocol  </th><th class="markdownTableHeadCenter">Encryption  </th><th class="markdownTableHeadCenter">Local Port  </th><th class="markdownTableHeadCenter">Request Target  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b><span class="tt">in-http</span></b>  </td><td class="markdownTableBodyCenter">IPv4  </td><td class="markdownTableBodyCenter">No  </td><td class="markdownTableBodyCenter"><span class="tt">8080</span>  </td><td class="markdownTableBodyCenter"><span class="tt">/</span> or <span class="tt">/clients</span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b><span class="tt">in-https</span></b>  </td><td class="markdownTableBodyCenter">IPv4  </td><td class="markdownTableBodyCenter">Yes  </td><td class="markdownTableBodyCenter"><span class="tt">8088</span>  </td><td class="markdownTableBodyCenter"><span class="tt">/</span> or <span class="tt">/clients</span>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b><span class="tt">in6-http</span></b>  </td><td class="markdownTableBodyCenter">IPv6  </td><td class="markdownTableBodyCenter">No  </td><td class="markdownTableBodyCenter"><span class="tt">8080</span>  </td><td class="markdownTableBodyCenter"><span class="tt">/</span> or <span class="tt">/clients</span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b><span class="tt">in6-https</span></b>  </td><td class="markdownTableBodyCenter">IPv6  </td><td class="markdownTableBodyCenter">Yes  </td><td class="markdownTableBodyCenter"><span class="tt">8088</span>  </td><td class="markdownTableBodyCenter"><span class="tt">/</span> or <span class="tt">/clients</span>  </td></tr>
</table>
<h3 class="doxsection"><a class="anchor" id="web-interface-over-unix-domain-sockets"></a>
Web Interface over UNIX Domain Sockets</h3>
<p>For local (same-host) communication, the broker also supports WebSockets over UNIX domain sockets.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><a href="https://github.com/SNodeC/snode.c?tab=readme-ov-file#instance-configuration">Instance</a>  </th><th class="markdownTableHeadCenter">Encryption  </th><th class="markdownTableHeadNone">Local Sun Path  </th><th class="markdownTableHeadCenter">Request Target  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b><span class="tt">un-http</span></b>  </td><td class="markdownTableBodyCenter">No  </td><td class="markdownTableBodyNone"><span class="tt">/tmp/mqttbroker-un-http</span>  </td><td class="markdownTableBodyCenter"><span class="tt">/</span> or <span class="tt">/clients</span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b><span class="tt">un-https</span></b>  </td><td class="markdownTableBodyCenter">Yes  </td><td class="markdownTableBodyNone"><span class="tt">/tmp/mqttbroker-un-https</span>  </td><td class="markdownTableBodyCenter"><span class="tt">/</span> or <span class="tt">/client</span>  </td></tr>
</table>
<h2 class="doxsection"><a class="anchor" id="additions--field-tested-guidance"></a>
Additions &amp; Field-Tested Guidance</h2>
<h3 class="doxsection"><a class="anchor" id="quick-tls-checklist-for-mqtttcp-and-mqtt-over-websockets"></a>
Quick TLS checklist for MQTT(TCP) and MQTT over WebSockets</h3>
<ul>
<li>Prepare the server certificate chain and private key; include a CA file/dir if you validate client certs or upstreams.</li>
<li>Apply via the <b>instance’s</b> <span class="tt">tls</span> section (e.g., <span class="tt">in-mqtts</span>, <span class="tt">in6-mqtts</span>, <span class="tt">in-https</span>, <span class="tt">in6-https</span>).</li>
<li>Verify CN/SAN covers the hostname clients use. <br  />
</li>
<li>Lock down key file permissions (e.g., <span class="tt">chmod 600</span> for the key, owned by the service user).</li>
<li>After a successful run, append <span class="tt">-w</span> to persist TLS configuration.</li>
</ul>
<h4 class="doxsection"><a class="anchor" id="example-tcptls"></a>
Example (TCP/TLS):</h4>
<div class="fragment"><div class="line">mqttbroker in-mqtts \</div>
<div class="line">               local --host 0.0.0.0 \</div>
<div class="line">                     --port 8883 \</div>
<div class="line">               tls --cert /etc/ssl/mqttsuite/server.crt \</div>
<div class="line">                   --cert-key /etc/ssl/mqttsuite/server.key \</div>
<div class="line">                   --ca-cert /etc/ssl/mqttsuite/ca.crt</div>
</div><!-- fragment --><h4 class="doxsection"><a class="anchor" id="example-websocketstls"></a>
Example (WebSockets/TLS):</h4>
<div class="fragment"><div class="line">mqttbroker in-https \</div>
<div class="line">               local --host 0.0.0.0 \</div>
<div class="line">                     --port 8088 \</div>
<div class="line">               tls --cert /etc/ssl/mqttsuite/server.crt</div>
<div class="line">                   --cert-key /etc/ssl/mqttsuite/server.key</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="making-configuration-persistent-recommended"></a>
Making configuration persistent (recommended)</h3>
<ul>
<li>Start the broker with your desired CLI options; verify behavior.</li>
<li>Run <b>once</b> with <span class="tt">-w</span> (or <span class="tt">--write-config</span>) to save the configuration.</li>
<li>Thereafter, start with just <span class="tt">mqttbroker</span> (and override via flags only when needed).</li>
</ul>
<p>Commonly persisted options:</p>
<ul>
<li><span class="tt">--mqtt-session-store &lt;path&gt;</span> — persist sessions across restarts.</li>
<li><span class="tt">--mqtt-mapping-file &lt;path.json&gt;</span> — enable the embedded integrator.</li>
<li><span class="tt">--html-dir &lt;path&gt;</span> — point the Web UI to your HTML templates.</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="websockets-specifics-that-often-trip-clients"></a>
WebSockets specifics that often trip clients</h3>
<ul>
<li><b>Subprotocol:</b> ensure clients send <span class="tt">Sec-WebSocket-Protocol: <a class="el" href="namespacemqtt.html">mqtt</a></span>. Most libraries expose this as a “subprotocol” option.</li>
<li><b>Request target:</b> use <span class="tt">/</span> or <span class="tt">/ws</span> (both are accepted by the WS and WSS instances).</li>
<li><b>Reverse proxies:</b> preserve <span class="tt">Upgrade</span>, <span class="tt">Connection</span>, and <span class="tt">Sec-WebSocket-Protocol</span> headers through the proxy.</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="quick-sanity-checks-with-common-tools"></a>
Quick sanity checks with common tools</h3>
<div class="fragment"><div class="line"># Plain MQTT over TCP</div>
<div class="line">mosquitto_sub -h 127.0.0.1 -p 1883 -t &#39;#&#39; -v</div>
<div class="line">mosquitto_pub -h 127.0.0.1 -p 1883 -t &#39;test/topic&#39; -m &#39;hello&#39;</div>
<div class="line"> </div>
<div class="line"># MQTT over WebSockets (HTTP)</div>
<div class="line">mosquitto_sub -h 127.0.0.1 -p 8080 -t &#39;#&#39; -v --protocol websockets</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="quick-sanity-checks-with-mqttsuites-command-line-tool"></a>
Quick sanity checks with MQTTSuites command line tool</h3>
<div class="fragment"><div class="line"># Subscribe (plain MQTT)</div>
<div class="line">mqttcli in-mqtt \</div>
<div class="line">            remote --host 127.0.0.1 \</div>
<div class="line">                   --port 1883 \</div>
<div class="line">            sub --topic &#39;#&#39;</div>
<div class="line"> </div>
<div class="line"># Publish (plain MQTT)</div>
<div class="line">mqttcli in-mqtt \</div>
<div class="line">            remote --host 127.0.0.1 \</div>
<div class="line">                   --port 1883 \</div>
<div class="line">            pub --topic &#39;test/topic&#39; \</div>
<div class="line">                --message &#39;hello&#39;</div>
<div class="line"> </div>
<div class="line"># MQTT over WebSockets (HTTP)</div>
<div class="line">mqttcli in-wsmqtt \</div>
<div class="line">            remote --host 127.0.0.1 \</div>
<div class="line">                   --port 8080 \</div>
<div class="line">            pub --topic &#39;test/topic&#39; \</div>
<div class="line">                --message &#39;hello&#39;</div>
<div class="line"> </div>
<div class="line"># MQTT over Unix Domain Sockets</div>
<div class="line">mqttcli un-mqtt \</div>
<div class="line">            remote --sun-path /tmp/mqttbroker-un-mqtt \</div>
<div class="line">            pub --topic &#39;test/topic&#39; \</div>
<div class="line">                --message &#39;hello&#39;</div>
<div class="line"> </div>
<div class="line"># Subscribe and publish at once</div>
<div class="line">mqttcli in-mqtt \</div>
<div class="line">            remote --host 127.0.0.1 \</div>
<div class="line">                   --port 1883 \</div>
<div class="line">            sub --topic &#39;#&#39; \</div>
<div class="line">            pub --topic &#39;test/topic&#39; \</div>
<div class="line">                --message &#39;hello&#39;</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="notes-for-unix-domain-sockets"></a>
Notes for UNIX domain sockets</h3>
<ul>
<li>Use the UNIX sockets (<span class="tt">/tmp/mqttbroker-un-mqtt*</span>) for same-host services; they offer low overhead and simple isolation.</li>
<li>Place sockets under <span class="tt">/run</span> or <span class="tt">/var/run</span> for service-managed lifecycles.</li>
<li>Ensure appropriate <b>ownership/group</b> (e.g., a dedicated <span class="tt">mqttsuite</span> group) and <b>permissions</b>, so clients can connect without elevating privileges.</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="embedded-mqttintegrator-when---mqtt-mapping-file-is-provided"></a>
Embedded MQTTIntegrator (when <span class="tt">--mqtt-mapping-file</span> is provided)</h3>
<ul>
<li>The broker can embed the <b>MQTTIntegrator</b> to transform/normalize payloads and remap topics without touching devices.</li>
<li>Typical uses:<ul>
<li>Define and execute complex processing logic for heterogeneous IoT systems, e.g., Smart Home orchestration or device-to-device rule sets.</li>
<li>Convert vendor-specific JSON into a normalized schema.</li>
<li>Scale/rename fields (e.g., <span class="tt">temp</span> → <span class="tt">temperature</span>, multiply by 0.1).</li>
<li>Route subsets of topics to dashboards or database consumers.</li>
</ul>
</li>
</ul>
<blockquote class="doxtable">
<p>Keep your mapping JSON in version control and validate changes in staging before production. </p>
</blockquote>
<h3 class="doxsection"><a class="anchor" id="extending-transports"></a>
Extending transports</h3>
<ul>
<li>Thanks to SNode.C’s layered network design, adding transports (e.g., Bluetooth RFCOMM/L2CAP) follows the same <b>instance</b> pattern as IPv4/IPv6 and UNIX.</li>
<li>Define endpoint parameters (address/port, channel, or path), optionally layer TLS (where applicable), and expose configuration via the broker’s CLI/config.</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="diagnostics-hardening--tips"></a>
Diagnostics, hardening &amp; tips</h3>
<p><b>Diagnostics</b></p>
<ul>
<li>If a listener fails to start, check for “port in use” conflicts or permission issues on UNIX sockets.</li>
<li>For WebSockets upgrade failures, verify the subprotocol and target path.</li>
</ul>
<p><b>Hardening</b></p>
<ul>
<li>Bind to specific interfaces as needed (e.g., <span class="tt">--listen 127.0.0.1</span> for local-only).</li>
<li>Use TLS for any untrusted network segments.</li>
<li>Restrict access to private keys and UNIX sockets (ownership/mode).</li>
<li>Apply firewall rules to limit exposure to necessary ports only.</li>
</ul>
<p><b>Common pitfalls</b></p>
<ul>
<li><b>TLS hostname mismatch:</b> client connects via a hostname not covered by CN/SAN.</li>
<li><b>Missing subprotocol on WS:</b> negotiation fails without <span class="tt"><a class="el" href="namespacemqtt.html">mqtt</a></span> subprotocol.</li>
<li><b>Permission denied on UNIX sockets:</b> fix group membership and file mode.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="protocol-version-note"></a>
Protocol version note</h2>
<ul>
<li>The broker implements <b>MQTT 3.1.1</b>. Configure client libraries accordingly unless you intentionally diverge.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="why-this-layout-works-well-in-production"></a>
Why this layout works well in production</h2>
<ul>
<li><b>Uniform instances:</b> Every listener (TCPv4/v6, UNIX, WS) is an <em>instance</em> with consistent options (listen address/port or path, TLS, limits). This keeps deployments predictable.</li>
<li><b>Predictable defaults:</b> Conventional ports (<span class="tt">1883/8883</span>, <span class="tt">8080/8088</span>) and request targets (<span class="tt">/</span> or <span class="tt">/ws</span>) make client configuration straightforward.</li>
<li><b>Persist-once workflow:</b> Use <span class="tt">-w</span> once, then keep day-to-day ops minimal and repeatable.</li>
</ul>
<hr  />
<h1 class="doxsection"><a class="anchor" id="mqtt-mapping-description"></a>
MQTT Mapping Description</h1>
<p>As optional for the MQTTBroker a MQTT mapping description is mandatory for the MQTTIntegrator.</p>
<h2 class="doxsection"><a class="anchor" id="purpose"></a>
Purpose</h2>
<p>An IoT app’s logic in <b>MQTTSuite</b> is expressed as a <b>JSON mapping file</b>. <br  />
 This file tells the <b>MQTTIntegrator</b> or <b>MQTTBroker</b> how to:</p>
<p>1) subscribe to incoming MQTT topics, <br  />
 2) translate (remap) the topics and payloads, and <br  />
 3) publish the translated messages back to the same broker connection.</p>
<p>A complete example lives in the Canonical Mapping &amp; Test Case section of the MQTTIntegrator description. The file must validate against the schema at <a href="https://github.com/SNodeC/mqttsuite/blob/master/lib/mapping-schema.json"><span class="tt">lib/mapping-schema.json</span></a>.</p>
<h2 class="doxsection"><a class="anchor" id="top-level-structure"></a>
Top-Level Structure</h2>
<p>A mapping description has three top-level objects:</p>
<ul>
<li><span class="tt">discover_prefix</span> — prefix for discovery topics (<b>currently not used</b>).</li>
<li><span class="tt">connection</span> — MQTT client options used by the integrator.</li>
<li><span class="tt">mapping</span> — the actual topic tree and translation rules.</li>
</ul>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;discover_prefix&quot;: &quot;snode.c&quot;,</div>
<div class="line">  &quot;connection&quot;: {</div>
<div class="line">    &quot;keep_alive&quot;: 60,</div>
<div class="line">    &quot;client_id&quot;: &quot;Client&quot;,</div>
<div class="line">    &quot;clean_session&quot;: true,</div>
<div class="line">    &quot;will_topic&quot;: &quot;will/topic&quot;,</div>
<div class="line">    &quot;will_message&quot;: &quot;Last Will&quot;,</div>
<div class="line">    &quot;will_qos&quot;: 0,</div>
<div class="line">    &quot;will_retain&quot;: false,</div>
<div class="line">    &quot;username&quot;: &quot;Username&quot;,</div>
<div class="line">    &quot;password&quot;: &quot;Password&quot;</div>
<div class="line">  },</div>
<div class="line">  &quot;mapping&quot;: {</div>
<div class="line">    /* see sections below */</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="connection-options-summary"></a>
<span class="tt">connection</span> options (summary)</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Field  </th><th class="markdownTableHeadCenter">Type  </th><th class="markdownTableHeadCenter">Default  </th><th class="markdownTableHeadNone">Notes  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">keep_alive</span>  </td><td class="markdownTableBodyCenter">integer  </td><td class="markdownTableBodyCenter"><span class="tt">60</span>  </td><td class="markdownTableBodyNone">Seconds between PINGREQs.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt">client_id</span>  </td><td class="markdownTableBodyCenter">string  </td><td class="markdownTableBodyCenter"><span class="tt">""</span>  </td><td class="markdownTableBodyNone">Logical client name.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">clean_session</span>  </td><td class="markdownTableBodyCenter">boolean  </td><td class="markdownTableBodyCenter"><span class="tt">true</span>  </td><td class="markdownTableBodyNone">Start clean or resume a retained session.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt">will_topic</span>  </td><td class="markdownTableBodyCenter">string  </td><td class="markdownTableBodyCenter"><span class="tt">""</span>  </td><td class="markdownTableBodyNone">Last Will topic.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">will_message</span>  </td><td class="markdownTableBodyCenter">string  </td><td class="markdownTableBodyCenter"><span class="tt">""</span>  </td><td class="markdownTableBodyNone">Last Will payload.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt">will_qos</span>  </td><td class="markdownTableBodyCenter">integer  </td><td class="markdownTableBodyCenter"><span class="tt">0</span>  </td><td class="markdownTableBodyNone"><span class="tt">0…2</span>.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">will_retain</span>  </td><td class="markdownTableBodyCenter">boolean  </td><td class="markdownTableBodyCenter"><span class="tt">false</span>  </td><td class="markdownTableBodyNone">Retain Last Will.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt">username</span>  </td><td class="markdownTableBodyCenter">string  </td><td class="markdownTableBodyCenter"><span class="tt">""</span>  </td><td class="markdownTableBodyNone">Username (optional).  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">password</span>  </td><td class="markdownTableBodyCenter">string  </td><td class="markdownTableBodyCenter"><span class="tt">""</span>  </td><td class="markdownTableBodyNone">Password (optional).  </td></tr>
</table>
<blockquote class="doxtable">
<p>The integrator uses these as <b>client</b> settings to connect to the broker it will subscribe to and republish on. </p>
</blockquote>
<h3 class="doxsection"><a class="anchor" id="the-mapping-object-big-picture"></a>
The <span class="tt">mapping</span> Object (big picture)</h3>
<p><span class="tt">mapping</span> defines a <b>topic hierarchy</b> and <b>subscriptions</b> with translation rules.</p>
<ul>
<li>A <b>topic level</b> is:<ul>
<li>a single object describing one topic, <b>or</b></li>
<li>an <b>array</b> of such objects describing <b>sibling</b> topics.</li>
</ul>
</li>
<li>Topic levels can be <b>recursively nested</b> to model trees.</li>
<li><span class="tt">topic_level.name</span> may be a <b>literal</b> (no wildcards) <b>or a single-character MQTT wildcard</b>: <br  />
<ul>
<li><span class="tt">+</span> → single-level wildcard <br  />
</li>
<li><span class="tt">#</span> → multi-level wildcard (typically used as a <b>leaf</b>)</li>
</ul>
</li>
</ul>
<h4 class="doxsection"><a class="anchor" id="minimal-shapes"></a>
Minimal shapes</h4>
<p><b>Single topic level</b></p>
<div class="fragment"><div class="line">&quot;mapping&quot;: {</div>
<div class="line">  &quot;topic_level&quot;: {</div>
<div class="line">    &quot;name&quot;: &quot;topic_level_name&quot;</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Nested topic levels</b></p>
<div class="fragment"><div class="line">&quot;mapping&quot;: {</div>
<div class="line">  &quot;topic_level&quot;: {</div>
<div class="line">    &quot;name&quot;: &quot;parent&quot;,</div>
<div class="line">    &quot;topic_level&quot;: {</div>
<div class="line">      &quot;name&quot;: &quot;child&quot;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Siblings with a nested child</b></p>
<div class="fragment"><div class="line">&quot;mapping&quot;: {</div>
<div class="line">  &quot;topic_level&quot;: [</div>
<div class="line">    { &quot;name&quot;: &quot;sibling_1&quot; },</div>
<div class="line">    {</div>
<div class="line">      &quot;name&quot;: &quot;sibling_2&quot;,</div>
<div class="line">      &quot;topic_level&quot;: { &quot;name&quot;: &quot;child_of_sibling_2&quot; }</div>
<div class="line">    }</div>
<div class="line">  ]</div>
<div class="line">}</div>
</div><!-- fragment --><h4 class="doxsection"><a class="anchor" id="wildcard-examples"></a>
Wildcard examples</h4>
<p><b>Single-level wildcard (<span class="tt">+</span>)</b>: subscribe to <span class="tt">home/+/temperature</span></p>
<div class="fragment"><div class="line">&quot;mapping&quot;: {</div>
<div class="line">  &quot;topic_level&quot;: {</div>
<div class="line">    &quot;name&quot;: &quot;home&quot;,</div>
<div class="line">    &quot;topic_level&quot;: [</div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;+&quot;,</div>
<div class="line">        &quot;topic_level&quot;: {</div>
<div class="line">          &quot;name&quot;: &quot;temperature&quot;</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">    ]</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Multi-level wildcard (<span class="tt">#</span>)</b>: subscribe to everything below <span class="tt">sensors/#</span></p>
<div class="fragment"><div class="line">&quot;mapping&quot;: {</div>
<div class="line">  &quot;topic_level&quot;: {</div>
<div class="line">    &quot;name&quot;: &quot;sensors&quot;,</div>
<div class="line">    &quot;topic_level&quot;: {</div>
<div class="line">      &quot;name&quot;: &quot;#&quot;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><blockquote class="doxtable">
<p>The integrator performs correct wildcard matching when subscribing and dispatching to the defined <span class="tt">subscription</span>. </p>
</blockquote>
<h4 class="doxsection"><a class="anchor" id="a-more-complex-hierarchy"></a>
A more complex hierarchy</h4>
<div class="image">
<img src="mqtt-topics.png" alt=""/>
<div class="caption">
A complex topic_level structure</div></div>
    <div class="fragment"><div class="line">&quot;mapping&quot;: {</div>
<div class="line">  &quot;topic_level&quot;: {</div>
<div class="line">    &quot;name&quot;: &quot;Home&quot;,</div>
<div class="line">    &quot;topic_level&quot;: [</div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;Bedroom&quot;,</div>
<div class="line">        &quot;topic_level&quot;: [</div>
<div class="line">          { &quot;name&quot;: &quot;...&quot; },</div>
<div class="line">          { &quot;name&quot;: &quot;...&quot; }</div>
<div class="line">        ]</div>
<div class="line">      },</div>
<div class="line">      { &quot;name&quot;: &quot;Garage&quot; },</div>
<div class="line">      {</div>
<div class="line">        &quot;name&quot;: &quot;Kitchen&quot;,</div>
<div class="line">        &quot;topic_level&quot;: [</div>
<div class="line">          {</div>
<div class="line">            &quot;name&quot;: &quot;Fridge&quot;,</div>
<div class="line">            &quot;topic_level&quot;: [</div>
<div class="line">              { &quot;name&quot;: &quot;Temperature&quot; },</div>
<div class="line">              { &quot;name&quot;: &quot;IceLevel&quot; }</div>
<div class="line">            ]</div>
<div class="line">          },</div>
<div class="line">          { &quot;name&quot;: &quot;Coffeemaker&quot; }</div>
<div class="line">        ]</div>
<div class="line">      }</div>
<div class="line">    ]</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="subscriptions--translation-rules"></a>
Subscriptions &amp; Translation Rules</h2>
<p>A <span class="tt">topic_level</span> can contain a <span class="tt">subscription</span> object. <br  />
 This instructs the integrator to <b>subscribe</b> to that concrete topic (using the topic path implied by the nested <span class="tt">name</span>s) and <b>map</b> incoming messages to new topics/payloads.</p>
<div class="fragment"><div class="line">&quot;topic_level&quot;: {</div>
<div class="line">  &quot;name&quot;: &quot;device&quot;,</div>
<div class="line">  &quot;topic_level&quot;: {</div>
<div class="line">    &quot;name&quot;: &quot;sensor&quot;,</div>
<div class="line">    &quot;subscription&quot;: {</div>
<div class="line">      &quot;type&quot;: &quot;binary_sensor&quot;,</div>
<div class="line">      &quot;qos&quot;: 2,</div>
<div class="line">      /* one of: static / value / json (or an array of them) */</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><ul>
<li><span class="tt">subscription.type</span> — freeform label (useful for UIs or discovery).</li>
<li><span class="tt">subscription.qos</span> — QoS used when the integrator subscribes at the broker (<span class="tt">0…2</span>). <br  />
 <em>Publishing QoS is set per mapping via its own <span class="tt">qos</span> field (see below).</em></li>
<li>Exactly one <b>mapping section</b> is required (or an <b>array</b> of them):<ul>
<li><span class="tt">static</span> — string-match mapping (exact incoming payload → mapped payload).</li>
<li><span class="tt">value</span> — template mapping where <span class="tt">message</span> is a scalar value.</li>
<li><span class="tt"><a class="el" href="binary-validation_8cpp.html#ab701e3ac61a85b337ec5c1abaad6742d">json</a></span> — template mapping where <span class="tt">message</span> is a JSON object.</li>
</ul>
</li>
</ul>
<blockquote class="doxtable">
<p>Each mapping section also accepts <b>arrays</b> (<span class="tt">[ … ]</span>) to apply multiple mappings for the same subscription. </p>
</blockquote>
<h2 class="doxsection"><a class="anchor" id="mapping-sections"></a>
Mapping Sections</h2>
<p>All mapping sections share <b>commons</b>:</p>
<ul>
<li><span class="tt">mapped_topic</span> <em>(string, required)</em> — destination topic. <br  />
 May be a <b>template</b> (supports <span class="tt">{{ ... }}</span>, <span class="tt">{{# ...}} … {{/ ...}}</span>) or a plain topic string (no <span class="tt">+</span> / <span class="tt">#</span>).</li>
<li><span class="tt">retain</span> <em>(boolean, default <span class="tt">false</span>)</em> — set MQTT retain on publishes.</li>
<li><span class="tt">qos</span> <em>(integer <span class="tt">0…2</span>, default <span class="tt">0</span>)</em> — <b>PUBLISH QoS</b> for the mapped message. <br  />
 <em>(Independent of <span class="tt">subscription.qos</span>.)</em></li>
</ul>
<h3 class="doxsection"><a class="anchor" id="static-mapping"></a>
<span class="tt">static</span> mapping</h3>
<p>Exact string-to-string payload conversion.</p>
<div class="fragment"><div class="line">&quot;static&quot;: {</div>
<div class="line">  &quot;mapped_topic&quot;: &quot;other_device/some_actuator/set&quot;,</div>
<div class="line">  &quot;message_mapping&quot;: [</div>
<div class="line">    { &quot;message&quot;: &quot;pressed&quot;,  &quot;mapped_message&quot;: &quot;on&quot;  },</div>
<div class="line">    { &quot;message&quot;: &quot;released&quot;, &quot;mapped_message&quot;: &quot;off&quot; }</div>
<div class="line">  ],</div>
<div class="line">  &quot;retain&quot;: false,</div>
<div class="line">  &quot;qos&quot;: 0</div>
<div class="line">}</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="value-mapping-template-scalar"></a>
<span class="tt">value</span> mapping (template, scalar)</h3>
<p>Treat the incoming payload as a <b>scalar</b> bound to the template variable <span class="tt">message</span>.</p>
<div class="fragment"><div class="line">&quot;value&quot;: {</div>
<div class="line">  &quot;mapped_topic&quot;: &quot;other_device/some_actuator/set&quot;,</div>
<div class="line">  &quot;mapping_template&quot;: &quot;{% if message == \&quot;pressed\&quot; %}on{% else if message == \&quot;released\&quot; %}off{% endif %}&quot;,</div>
<div class="line">  &quot;retain&quot;: false,</div>
<div class="line">  &quot;qos&quot;: 0</div>
<div class="line">}</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="json-mapping-template-object"></a>
<span class="tt">json</span> mapping (template, object)</h3>
<p>Treat the incoming payload as a <b>JSON object</b>, available as <span class="tt">message</span> inside the template.</p>
<div class="fragment"><div class="line">&quot;json&quot;: {</div>
<div class="line">  &quot;mapped_topic&quot;: &quot;other_device/some_actuator/set&quot;,</div>
<div class="line">  &quot;mapping_template&quot;: &quot;{{ message.time.start }} to {{ message.time.end + 1 }}pm&quot;,</div>
<div class="line">  &quot;retain&quot;: false,</div>
<div class="line">  &quot;qos&quot;: 0</div>
<div class="line">}</div>
</div><!-- fragment --><h4 class="doxsection"><a class="anchor" id="example-input"></a>
Example input</h4>
<div class="fragment"><div class="line">{ &quot;time&quot;: { &quot;start&quot;: 5, &quot;end&quot;: 10 } }</div>
</div><!-- fragment --><h4 class="doxsection"><a class="anchor" id="rendered-output--5-to-11pm"></a>
Rendered output → <span class="tt">5 to 11pm</span></h4>
<h3 class="doxsection"><a class="anchor" id="template-extras"></a>
Template extras</h3>
<ul>
<li><p class="startli">For template mappings (<span class="tt">value</span> / <span class="tt"><a class="el" href="binary-validation_8cpp.html#ab701e3ac61a85b337ec5c1abaad6742d">json</a></span>), an optional field is available:</p>
<div class="fragment"><div class="line">&quot;suppressions&quot;: []</div>
</div><!-- fragment --><p class="startli">Use this list for implementation-specific template controls. If unused, keep it empty (<span class="tt">[]</span>).</p>
</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="optional-plugins"></a>
Optional: <span class="tt">plugins</span></h2>
<p>Inside <span class="tt">mapping</span>, you may provide an optional <span class="tt">plugins</span> array:</p>
<div class="fragment"><div class="line">&quot;mapping&quot;: {</div>
<div class="line">  &quot;plugins&quot;: [&quot;pluginA&quot;, &quot;pluginB&quot;],</div>
<div class="line">  &quot;topic_level&quot;: { /* … */ }</div>
<div class="line">}</div>
</div><!-- fragment --><p>This is a list of plugin identifiers that the integrator may use to extend mapping behavior. <br  />
 (Behavior is implementation-specific; leave empty if not needed.)</p>
<h2 class="doxsection"><a class="anchor" id="quick-start-recommended-flow-1"></a>
Quick Start (Recommended Flow)</h2>
<h3 class="doxsection"><a class="anchor" id="skeleton-mapping-file"></a>
Skeleton mapping file</h3>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;discover_prefix&quot;: &quot;&quot;,</div>
<div class="line">  &quot;connection&quot;: { </div>
<div class="line">    &quot;keep_alive&quot;: 60,</div>
<div class="line">    &quot;clean_session&quot;: true</div>
<div class="line">  },</div>
<div class="line">  &quot;mapping&quot;: { </div>
<div class="line">    &quot;topic_level&quot;: {</div>
<div class="line">      &quot;name&quot;: &quot;devices&quot;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="add-a-concrete-subscription-with-a-simple-static-mapping"></a>
Add a concrete subscription with a simple static mapping</h3>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;mapping&quot;: {</div>
<div class="line">    &quot;topic_level&quot;: {</div>
<div class="line">      &quot;name&quot;: &quot;devices&quot;,</div>
<div class="line">      &quot;topic_level&quot;: {</div>
<div class="line">        &quot;name&quot;: &quot;button&quot;,</div>
<div class="line">        &quot;subscription&quot;: {</div>
<div class="line">          &quot;type&quot;: &quot;binary_sensor&quot;,</div>
<div class="line">          &quot;qos&quot;: 0,</div>
<div class="line">          &quot;static&quot;: {</div>
<div class="line">            &quot;mapped_topic&quot;: &quot;actuators/light/set&quot;,</div>
<div class="line">            &quot;message_mapping&quot;: [</div>
<div class="line">              { &quot;message&quot;: &quot;pressed&quot;,  &quot;mapped_message&quot;: &quot;on&quot;  },</div>
<div class="line">              { &quot;message&quot;: &quot;released&quot;, &quot;mapped_message&quot;: &quot;off&quot; }</div>
<div class="line">            ]</div>
<div class="line">          }</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="switch-to-a-template-mapping-when-you-need-logic"></a>
Switch to a template mapping when you need logic</h3>
<div class="fragment"><div class="line">&quot;subscription&quot;: {</div>
<div class="line">  &quot;type&quot;: &quot;thermo&quot;,</div>
<div class="line">  &quot;qos&quot;: 1,</div>
<div class="line">  &quot;json&quot;: {</div>
<div class="line">    &quot;mapped_topic&quot;: &quot;sensors/room1/summary&quot;,</div>
<div class="line">    &quot;mapping_template&quot;: &quot;T={{ message.temp }};H={{ message.hum }}&quot;</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="validate-against-the-schema-example-with-ajv-cli"></a>
Validate against the schema (example with <span class="tt">ajv-cli</span>)</h3>
<div class="fragment"><div class="line">ajv validate -s lib/mapping-schema.json -d your-mapping.json</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="run-the-integrator-with-your-mapping"></a>
Run the integrator with your mapping</h3>
<div class="fragment"><div class="line">mqttintegrator --mqtt-mapping-file your-mapping.json</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="field-tested-guidance"></a>
Field-Tested Guidance</h2>
<ul>
<li><b>Use wildcards deliberately.</b> <span class="tt">+</span> is perfect for “same depth, many devices”; <span class="tt">#</span> is best at a <b>leaf</b> to catch everything below a prefix.</li>
<li><b>Start simple.</b> Verify flow with a <span class="tt">static</span> mapping; then move to <span class="tt">value</span>/<span class="tt"><a class="el" href="binary-validation_8cpp.html#ab701e3ac61a85b337ec5c1abaad6742d">json</a></span> templates.</li>
<li><b>Arrays unlock fan-out.</b> <span class="tt">static</span> / <span class="tt">value</span> / <span class="tt"><a class="el" href="binary-validation_8cpp.html#ab701e3ac61a85b337ec5c1abaad6742d">json</a></span> accept arrays—emit multiple outputs from one input.</li>
<li><b>Decide <span class="tt">retain</span> intentionally.</b> For derived state (e.g., “current mode”), <span class="tt">retain: true</span> is often useful; for events, prefer <span class="tt">false</span>.</li>
<li><b>QoS roles are separate.</b> <span class="tt">subscription.qos</span> = <b>subscribe QoS</b>; mapping <span class="tt">qos</span> = <b>publish QoS</b>.</li>
<li><b>Validate early.</b> Keep the schema in CI; reject invalid mappings before deployment.</li>
<li><b>Version control.</b> Store mapping files with your app; review changes and test on staging.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="schema-highlights"></a>
Schema Highlights</h2>
<ul>
<li><b>Root</b>: <span class="tt">mapping</span> is <b>required</b>.</li>
<li><b><span class="tt">mapping.topic_level</span></b>: a single object <b>or</b> an array of them. <br  />
 Each <span class="tt">topic_level</span> <b>requires</b> <span class="tt">name</span> and <b>either</b> a nested <span class="tt">topic_level</span> <b>or</b> a <span class="tt">subscription</span>.</li>
<li><b><span class="tt">topic_level.name</span></b>: may be a literal <b>or</b> a single-char wildcard <span class="tt">+</span> or <span class="tt">#</span> (per schema pattern). <br  />
 <span class="tt">#</span> is typically used at a leaf.</li>
<li><b>Mapping sections</b>: require either or an array of <span class="tt">static</span>, <span class="tt">value</span>, or <span class="tt"><a class="el" href="binary-validation_8cpp.html#ab701e3ac61a85b337ec5c1abaad6742d">json</a></span> (each may be an array).</li>
<li><b><span class="tt">mapped_topic</span></b>: non-empty; either a plain topic (no <span class="tt">+/#</span>) <b>or</b> a template expression.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="in-one-sentence"></a>
In one sentence</h2>
<p><b>Model the topic tree (literals and <span class="tt">+</span>/<span class="tt">#</span>) → choose subscription points (with subscribe QoS) → translate via <span class="tt">static</span> / <span class="tt">value</span> / <span class="tt"><a class="el" href="binary-validation_8cpp.html#ab701e3ac61a85b337ec5c1abaad6742d">json</a></span> (with publish QoS) → validate with the schema → run the integrator.</b></p>
<hr  />
<h1 class="doxsection"><a class="anchor" id="mqttintegrator"></a>
MQTTIntegrator</h1>
<p>The <em>MQTTIntegrator</em> is the lightweight transformation engine of the <b>MQTTSuite</b>. It subscribes to topics on an MQTT broker, <b>translates</b> topics/payloads using the <b>mapping description</b> (presented earlier), and <b>publishes the translated messages back to the same broker connection</b>.</p>
<p>Additional transports can be added in the source: <a href="https://github.com/SNodeC/mqttsuite/blob/master/mqttintegrator/mqttintegrator.cpp"><span class="tt">mqttintegrator.cpp</span></a>.</p>
<h2 class="doxsection"><a class="anchor" id="connection-instances-of-default-builds-of-mqttintegrator"></a>
Connection instances of default builds of <em>MQTTIntegrator</em></h2>
<ul>
<li><span class="tt">in-mqtt</span>: MQTT over IPv4 (client to remote <span class="tt">1883</span>)</li>
<li><span class="tt">in-mqtts</span>: MQTTS over IPv4 (client to remote <span class="tt">8883</span>)</li>
<li><span class="tt">in6-mqtt</span>: MQTT over IPv6 (client to remote <span class="tt">1883</span>)</li>
<li><span class="tt">in6-mqtts</span>: MQTTS over IPv6 (client to remote <span class="tt">8883</span>)</li>
<li><span class="tt">un-mqtt</span>: MQTT over Unix Domain Sockets (client to remote sun path)</li>
<li><span class="tt">un-mqtts</span>: MQTTS over Unix Domain Sockets (client to remote sun path)</li>
<li><span class="tt">in-wsmqtt</span>: MQTT over WebSockets via IPv4 (client to remote <span class="tt">8080</span>, target <span class="tt">/ws</span>)</li>
<li><span class="tt">in-wsmqtts</span>: MQTTS over WebSockets via IPv4 (client to remote <span class="tt">8088</span>, target <span class="tt">/ws</span>)</li>
<li><span class="tt">in6-wsmqtt</span>: MQTT over WebSockets via IPv6 (client to remote <span class="tt">8080</span>, target <span class="tt">/ws</span>)</li>
<li><span class="tt">in6-wsmqtts</span>: MQTTS over WebSockets via IPv6 (client to remote <span class="tt">8088</span>, target <span class="tt">/ws</span>)</li>
<li><span class="tt">un-wsmqtt</span>: MQTT over <b>Unix Domain WebSockets</b> (client to remote sun path, target <span class="tt">/ws</span>)</li>
<li><span class="tt">un-wsmqtts</span>: MQTTS over <b>Unix Domain WebSockets</b> (client to remote sun path, target <span class="tt">/ws</span>)</li>
</ul>
<p>One can control which instances are built by enabling or disabling them through the available <span class="tt">cmake</span> options.</p>
<h2 class="doxsection"><a class="anchor" id="configuration-1"></a>
Configuration</h2>
<p>All aspects—such as <b>remote</b> host/port, UNIX <em>sun</em> paths, WebSocket request targets, and per-connection options—are configurable via the <a href="https://github.com/SNodeC/snode.c?tab=readme-ov-file#configuration">SNode.C configuration system</a>. You can set options in code, on the command line, or via a configuration file.</p>
<p>If encrypted access to the broker is required, <a href="https://github.com/SNodeC/snode.c?tab=readme-ov-file#ssltls-configuration-section-tls">suitable certificates need to be provided</a> for the <b>client</b> connection.</p>
<h2 class="doxsection"><a class="anchor" id="notes-1"></a>
Notes</h2>
<ul>
<li><b>Persistent sessions:</b> Configure a <em>session store</em> if you want the client session to survive restarts: <br  />
 <span class="tt">--mqtt-session-store &lt;path-to-session-store-file&gt;</span>.</li>
<li><b>Mapping file (required for translations):</b> Provide <span class="tt">--mqtt-mapping-file &lt;path-to-mqtt-mapping-file.json&gt;</span>. <br  />
 The mapping syntax, wildcard support (<span class="tt">+</span>, <span class="tt">#</span>), <b>subscribe QoS</b> vs <b>publish QoS</b>, and templating are documented in the <b>MQTT Mapping Description</b> section placed before this one.</li>
<li><b>Active instances by default:</b> After installation, all connection instances are enabled. Disable unused ones explicitly with <span class="tt">--disabled</span> on those instances.</li>
<li><b>Persisting options:</b> Use <span class="tt">--write-config</span> or <span class="tt">-w</span> once to store current options in the configuration file.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="quick-start-recommended-flow-2"></a>
Quick Start (Recommended Flow)</h2>
<p>Per default, all supported connection instances are <b>enabled</b>. Disable what you don’t use and keep a single, clear path to your broker.</p>
<h3 class="doxsection"><a class="anchor" id="disable-all-but-the-in-mqtt-instance-1"></a>
Disable all but the <span class="tt">in-mqtt</span> instance</h3>
<div class="fragment"><div class="line">mqttintegrator in-mqtts --disabled</div>
<div class="line">               in6-mqtt --disabled</div>
<div class="line">               in6-mqtts --disabled</div>
<div class="line">               un-mqtt --disabled</div>
<div class="line">               un-mqtts --disabled</div>
<div class="line">               in-wsmqtt --disabled</div>
<div class="line">               in-wsmqtts --disabled</div>
<div class="line">               in6-wsmqtt --disabled</div>
<div class="line">               in6-wsmqtts --disabled</div>
<div class="line">               un-wsmqtt --disabled</div>
<div class="line">               un-wsmqtts --disabled</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="connect-to-a-plain-mqtt-broker-over-tcpipv4"></a>
Connect to a plain MQTT broker over TCP/IPv4</h3>
<div class="fragment"><div class="line">mqttintegrator in-mqtt \</div>
<div class="line">                   remote --host 127.0.0.1 \</div>
<div class="line">                          --port 1883</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="add-a-persistent-session-store-survives-restarts-1"></a>
Add a persistent session store (survives restarts)</h3>
<div class="fragment"><div class="line">mqttintegrator --mqtt-session-store /var/lib/mqttsuite/mqttintegrator/session.store \</div>
<div class="line">               in-mqtt \</div>
<div class="line">                   remote --host 127.0.0.1 \</div>
<div class="line">                          --port 1883</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="attach-your-mapping-file-canonical-test-case-below"></a>
Attach your mapping file (canonical test case below)</h3>
<div class="fragment"><div class="line">mqttintegrator --mqtt-session-store /var/lib/mqttsuite/mqttintegrator/session.store \</div>
<div class="line">               --mqtt-mapping-file /etc/mqttsuite/mappings/mapping-example.json \</div>
<div class="line">               in-mqtt \</div>
<div class="line">                   remote --host 127.0.0.1 \</div>
<div class="line">                          --port 1883</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="persist-your-configuration-using--w"></a>
Persist your configuration using <span class="tt">-w</span></h3>
<div class="fragment"><div class="line">mqttintegrator --mqtt-session-store /var/lib/mqttsuite/mqttintegrator/session.store \</div>
<div class="line">               --mqtt-mapping-file /etc/mqttsuite/mappings/mapping-example.json \</div>
<div class="line">               in-mqtt \</div>
<div class="line">                   remote --host 127.0.0.1 \</div>
<div class="line">                          --port 1883 \</div>
<div class="line">               -w</div>
</div><!-- fragment --><p>From now on, a plain <span class="tt">mqttintegrator</span> starts with the stored configuration.</p>
<h3 class="doxsection"><a class="anchor" id="optional-use-tls-mqtts-instead-of-plain-tcp"></a>
(Optional) Use TLS (MQTTS) instead of plain TCP</h3>
<div class="fragment"><div class="line">mqttintegrator in-mqtts --disabled=false \</div>
<div class="line">                   remote --host broker.example.org \</div>
<div class="line">                          --port 8883 \</div>
<div class="line">                   tls --cert /etc/ssl/mqttsuite/client.crt \</div>
<div class="line">                       --cert-key /etc/ssl/mqttsuite/client.key \</div>
<div class="line">                       --ca-cert /etc/ssl/mqttsuite/ca.crt</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="optional-use-websockets-wss"></a>
(Optional) Use WebSockets (WSS)</h3>
<div class="fragment"><div class="line">mqttintegrator in-wsmqtts --disabled=false \</div>
<div class="line">                   remote --host broker.example.org \</div>
<div class="line">                          --port 8088 \</div>
<div class="line">                   tls --ca-cert /etc/ssl/mqttsuite/ca.crt</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="optional-use-unix-domain-websockets"></a>
(Optional) Use Unix Domain WebSockets</h3>
<div class="fragment"><div class="line">mqttintegrator un-wsmqtt --disabled=false \</div>
<div class="line">                   remote --sun-path /tmp/mqttbroker-un-http</div>
<div class="line"> </div>
<div class="line">mqttintegrator un-wsmqtts --disabled=false \</div>
<div class="line">                   remote --sun-path /tmp/mqttbroker-un-https3 \</div>
<div class="line">                   tls --ca-cert /etc/ssl/mqttsuite/ca.crt</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="supported-transports-1"></a>
Supported Transports</h2>
<p>The <em>MQTTIntegrator</em> uses a <b>client</b> connection to a single broker. All tables show <b>remote</b> endpoints (not local listeners). <br  />
 Disable unused instances with <span class="tt">--disabled</span>.</p>
<h3 class="doxsection"><a class="anchor" id="mqtt-over-tcpip-1"></a>
MQTT over TCP/IP</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><a href="https://github.com/SNodeC/snode.c?tab=readme-ov-file#instance-configuration">Instance</a>  </th><th class="markdownTableHeadCenter">Protocol  </th><th class="markdownTableHeadCenter">Encryption  </th><th class="markdownTableHeadCenter">Remote Port  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b><span class="tt">in-mqtt</span></b>  </td><td class="markdownTableBodyCenter">IPv4  </td><td class="markdownTableBodyCenter">No  </td><td class="markdownTableBodyCenter"><span class="tt">1883</span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b><span class="tt">in-mqtts</span></b>  </td><td class="markdownTableBodyCenter">IPv4  </td><td class="markdownTableBodyCenter">Yes  </td><td class="markdownTableBodyCenter"><span class="tt">8883</span>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b><span class="tt">in6-mqtt</span></b>  </td><td class="markdownTableBodyCenter">IPv6  </td><td class="markdownTableBodyCenter">No  </td><td class="markdownTableBodyCenter"><span class="tt">1883</span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b><span class="tt">in6-mqtts</span></b>  </td><td class="markdownTableBodyCenter">IPv6  </td><td class="markdownTableBodyCenter">Yes  </td><td class="markdownTableBodyCenter"><span class="tt">8883</span>  </td></tr>
</table>
<h3 class="doxsection"><a class="anchor" id="mqtt-over-unix-domain-sockets-1"></a>
MQTT over UNIX Domain Sockets</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><a href="https://github.com/SNodeC/snode.c?tab=readme-ov-file#instance-configuration">Instance</a>  </th><th class="markdownTableHeadCenter">Encryption  </th><th class="markdownTableHeadNone">Remote Sun Path  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b><span class="tt">un-mqtt</span></b>  </td><td class="markdownTableBodyCenter">No  </td><td class="markdownTableBodyNone"><span class="tt">/tmp/mqttbroker-un-mqtt</span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b><span class="tt">un-mqtts</span></b>  </td><td class="markdownTableBodyCenter">Yes  </td><td class="markdownTableBodyNone"><span class="tt">/tmp/mqttbroker-un-mqtts</span>  </td></tr>
</table>
<h3 class="doxsection"><a class="anchor" id="mqtt-over-websockets-1"></a>
MQTT over WebSockets</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><a href="https://github.com/SNodeC/snode.c?tab=readme-ov-file#instance-configuration">Instance</a>  </th><th class="markdownTableHeadCenter">Protocol  </th><th class="markdownTableHeadCenter">Encryption  </th><th class="markdownTableHeadCenter">Remote Port  </th><th class="markdownTableHeadCenter">Request Target  </th><th class="markdownTableHeadCenter">Sec-WebSocket-Protocol  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b><span class="tt">in-wsmqtt</span></b>  </td><td class="markdownTableBodyCenter">IPv4  </td><td class="markdownTableBodyCenter">No  </td><td class="markdownTableBodyCenter"><span class="tt">8080</span>  </td><td class="markdownTableBodyCenter"><span class="tt">/ws</span>  </td><td class="markdownTableBodyCenter"><span class="tt"><a class="el" href="namespacemqtt.html">mqtt</a></span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b><span class="tt">in-wsmqtts</span></b>  </td><td class="markdownTableBodyCenter">IPv4  </td><td class="markdownTableBodyCenter">Yes  </td><td class="markdownTableBodyCenter"><span class="tt">8088</span>  </td><td class="markdownTableBodyCenter"><span class="tt">/ws</span>  </td><td class="markdownTableBodyCenter"><span class="tt"><a class="el" href="namespacemqtt.html">mqtt</a></span>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b><span class="tt">in6-wsmqtt</span></b>  </td><td class="markdownTableBodyCenter">IPv6  </td><td class="markdownTableBodyCenter">No  </td><td class="markdownTableBodyCenter"><span class="tt">8080</span>  </td><td class="markdownTableBodyCenter"><span class="tt">/ws</span>  </td><td class="markdownTableBodyCenter"><span class="tt"><a class="el" href="namespacemqtt.html">mqtt</a></span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b><span class="tt">in6-wsmqtts</span></b>  </td><td class="markdownTableBodyCenter">IPv6  </td><td class="markdownTableBodyCenter">Yes  </td><td class="markdownTableBodyCenter"><span class="tt">8088</span>  </td><td class="markdownTableBodyCenter"><span class="tt">/ws</span>  </td><td class="markdownTableBodyCenter"><span class="tt"><a class="el" href="namespacemqtt.html">mqtt</a></span>  </td></tr>
</table>
<h3 class="doxsection"><a class="anchor" id="mqtt-over-unix-domain-websockets-1"></a>
MQTT over UNIX Domain WebSockets</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><a href="https://github.com/SNodeC/snode.c?tab=readme-ov-file#instance-configuration">Instance</a>  </th><th class="markdownTableHeadCenter">Encryption  </th><th class="markdownTableHeadCenter">Remote Sun Path  </th><th class="markdownTableHeadCenter">Request Target  </th><th class="markdownTableHeadCenter">Sec-WebSocket-Protocol  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b><span class="tt">un-wsmqtt</span></b>  </td><td class="markdownTableBodyCenter">No  </td><td class="markdownTableBodyCenter"><span class="tt">/tmp/mqttbroker-un-http</span>  </td><td class="markdownTableBodyCenter"><span class="tt">/ws</span>  </td><td class="markdownTableBodyCenter"><span class="tt"><a class="el" href="namespacemqtt.html">mqtt</a></span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b><span class="tt">un-wsmqtts</span></b>  </td><td class="markdownTableBodyCenter">Yes  </td><td class="markdownTableBodyCenter"><span class="tt">/tmp/mqttbroker-un-https</span>  </td><td class="markdownTableBodyCenter"><span class="tt">/ws</span>  </td><td class="markdownTableBodyCenter"><span class="tt"><a class="el" href="namespacemqtt.html">mqtt</a></span>  </td></tr>
</table>
<h3 class="doxsection"><a class="anchor" id="notes-2"></a>
Notes</h3>
<ul>
<li>For all WS/WSS/UDS-WS instances, the integrator uses <span class="tt">Sec-WebSocket-Protocol: <a class="el" href="namespacemqtt.html">mqtt</a></span> and the request target <span class="tt">/ws</span>.</li>
<li>All instances above are enabled by default after installation; deactivate any unneeded instance with <span class="tt">--disabled</span>.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="canonical-mapping--test-case"></a>
Canonical Mapping &amp; Test Case</h2>
<p>This minimal, <b>schema-valid</b> mapping subscribes to <span class="tt">kitchen/thermostat/1</span> and publishes to <b><span class="tt">kitchen/heating/1/set</span></b>:</p>
<ul>
<li><span class="tt">"on"</span> if <span class="tt">temp &lt; 21.0</span></li>
<li><span class="tt">"off"</span> if <span class="tt">temp &gt; 23.0</span></li>
<li><b>no publish</b> in the 21.0–23.0 deadband</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="save-as-mapping-examplejson"></a>
Save as <span class="tt">~/mapping-example.json</span>:</h3>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;discover_prefix&quot;: &quot;snode.c&quot;,</div>
<div class="line">  &quot;connection&quot;: {</div>
<div class="line">    &quot;keep_alive&quot;: 60,</div>
<div class="line">    &quot;client_id&quot;: &quot;Client&quot;,</div>
<div class="line">    &quot;clean_session&quot;: true,</div>
<div class="line">    &quot;will_topic&quot;: &quot;will/topic&quot;,</div>
<div class="line">    &quot;will_message&quot;: &quot;Last Will&quot;,</div>
<div class="line">    &quot;will_qos&quot;: 0,</div>
<div class="line">    &quot;will_retain&quot;: false,</div>
<div class="line">    &quot;username&quot;: &quot;Username&quot;,</div>
<div class="line">    &quot;password&quot;: &quot;Password&quot;</div>
<div class="line">  },</div>
<div class="line">  &quot;mapping&quot;: {</div>
<div class="line">    &quot;topic_level&quot;: {</div>
<div class="line">      &quot;name&quot;: &quot;kitchen&quot;,</div>
<div class="line">      &quot;topic_level&quot;: {</div>
<div class="line">        &quot;name&quot;: &quot;thermostat&quot;,</div>
<div class="line">        &quot;topic_level&quot;: {</div>
<div class="line">          &quot;name&quot;: &quot;1&quot;,</div>
<div class="line">          &quot;subscription&quot;: {</div>
<div class="line">            &quot;type&quot;: &quot;thermostat&quot;,</div>
<div class="line">            &quot;qos&quot;: 0,</div>
<div class="line">            &quot;json&quot;: {</div>
<div class="line">              &quot;mapped_topic&quot;: &quot;kitchen/heating/1/set&quot;,</div>
<div class="line">              &quot;mapping_template&quot;: &quot;{% if message.temp &lt; 21.0 %}on{% else if message.temp &gt; 23.0 %}off{% endif %}&quot;,</div>
<div class="line">              &quot;retain&quot;: false,</div>
<div class="line">              &quot;qos&quot;: 0,</div>
<div class="line">              &quot;suppressions&quot;: [&quot;&quot;]</div>
<div class="line">            }</div>
<div class="line">          }</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="run-the-integrator-for-this-mapping-in-mqtt"></a>
Run the integrator for this mapping (in-mqtt):</h3>
<div class="fragment"><div class="line">mqttintegrator --mqtt-session-store ~/session.store \</div>
<div class="line">               --mqtt-mapping-file ~/mapping-example.json \</div>
<div class="line">               in-mqtt \</div>
<div class="line">                   remote --host 127.0.0.1 \</div>
<div class="line">                          --port 1883</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="persist-once"></a>
Persist once:</h3>
<div class="fragment"><div class="line">mqttintegrator --mqtt-session-store ~/session.store \</div>
<div class="line">               --mqtt-mapping-file ~/mapping-example.json \</div>
<div class="line">               in-mqtt</div>
<div class="line">                   remote --host 127.0.0.1</div>
<div class="line">                          --port 1883 \</div>
<div class="line">               -w</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="then-just-run"></a>
Then just run</h3>
<div class="fragment"><div class="line">mqttintegrator</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="verification"></a>
Verification</h3>
<div class="fragment"><div class="line"># Observe mapped results</div>
<div class="line">mqttcli in-mqtt</div>
<div class="line">            remote --host 127.0.0.1 \</div>
<div class="line">                   --port 1883 \</div>
<div class="line">            sub --topic &#39;kitchen/heating/1/set&#39;</div>
<div class="line">            </div>
<div class="line"> </div>
<div class="line"># 20.9 → &quot;on&quot;</div>
<div class="line">mqttcli in-mqtt</div>
<div class="line">            remote --host 127.0.0.1 \</div>
<div class="line">                   --port 1883 \</div>
<div class="line">            pub --topic &#39;kitchen/thermostat/1&#39;</div>
<div class="line">                --message &#39;{&quot;temp&quot;:20.9}&#39;</div>
<div class="line">                </div>
<div class="line"># 23.5 → &quot;off&quot;mqttcli in-mqtt</div>
<div class="line">            remote --host 127.0.0.1 \</div>
<div class="line">                   --port 1883 \</div>
<div class="line">            pub --topic &#39;kitchen/thermostat/1&#39;</div>
<div class="line">                --message &#39;{&quot;temp&quot;:23.5}&#39;</div>
<div class="line">                </div>
<div class="line"># 22.7 → deadband → no publish</div>
<div class="line">mqttcli in-mqtt</div>
<div class="line">            remote --host 127.0.0.1 \</div>
<div class="line">                   --port 1883 \</div>
<div class="line">            pub --topic &#39;kitchen/thermostat/1&#39;</div>
<div class="line">                --message &#39;{&quot;temp&quot;:22.7}&#39;</div>
</div><!-- fragment --><p><b>QoS roles:</b> <span class="tt">subscription.qos</span> controls the <b>subscribe</b> QoS. The <span class="tt">json.qos</span> inside the mapping controls the <b>publish</b> QoS for the mapped message.</p>
<h2 class="doxsection"><a class="anchor" id="behavior-aligned-with-the-mapping-description"></a>
Behavior aligned with the Mapping Description</h2>
<ul>
<li>The <b>mapping file</b> defines where the integrator places <b>subscriptions</b> in the topic tree (including support for <span class="tt">+</span> and <span class="tt">#</span> in <span class="tt">topic_level.name</span>). The integrator performs correct wildcard matching when subscribing and dispatching.</li>
<li><span class="tt">subscription.qos</span> specifies the QoS used to subscribe at the broker; it does not control publish QoS.</li>
<li>Each mapping rule (in <span class="tt">static</span>, <span class="tt">value</span>, or <span class="tt"><a class="el" href="binary-validation_8cpp.html#ab701e3ac61a85b337ec5c1abaad6742d">json</a></span>) has its own publish <span class="tt">qos</span> and <span class="tt">retain</span> flags and a <span class="tt">mapped_topic</span> (string or template).</li>
<li>Arrays are allowed (<span class="tt">static</span> / <span class="tt">value</span> / <span class="tt"><a class="el" href="binary-validation_8cpp.html#ab701e3ac61a85b337ec5c1abaad6742d">json</a></span>), enabling <b>fan-out</b> (multiple publishes per inbound message).</li>
<li>The integrator <b>republishes</b> transformed messages <b>back to the same broker connection</b> from which they were received.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="additions--field-tested-guidance-1"></a>
Additions &amp; Field-Tested Guidance</h2>
<h3 class="doxsection"><a class="anchor" id="tls-checklist-for-client-connections-mqtts--wss--uds-wss"></a>
TLS checklist for client connections (MQTTS / WSS / UDS-WSS)</h3>
<ul>
<li>Provide <b>client certificate &amp; key</b> if your broker enforces mutual TLS; otherwise a CA bundle is often sufficient.</li>
<li>Ensure the broker hostname you connect to is covered by the server certificate’s <b>CN/SAN</b> (for TCP/WSS).</li>
<li>Lock down permissions on key files (e.g., <span class="tt">chmod 600</span>, owned by the service user).</li>
<li>Configure TLS under the chosen instance’s <span class="tt">tls</span> subsection.</li>
</ul>
<h4 class="doxsection"><a class="anchor" id="example-tcptls-with-mutual-tls"></a>
Example (TCP/TLS) with mutual TLS:</h4>
<div class="fragment"><div class="line">mqttintegrator in-mqtts \</div>
<div class="line">                  remote --host broker.example.org \</div>
<div class="line">                         --port 8883 \</div>
<div class="line">                  tls --ca-cert /etc/ssl/mqttsuite/ca.crt \</div>
<div class="line">                      --cert /etc/ssl/mqttsuite/cert.crt \</div>
<div class="line">                      --cert-key /etc/ssl/mqttsuite/cert.key \</div>
<div class="line">                      --cert-key-password &#39;some-password&#39;</div>
</div><!-- fragment --><h4 class="doxsection"><a class="anchor" id="example-websocketstls-1"></a>
Example (WebSockets/TLS):</h4>
<div class="fragment"><div class="line">mqttintegrator in-wsmqtts \</div>
<div class="line">                  remote --host broker.example.org \</div>
<div class="line">                         --port 8088 \</div>
<div class="line">                  tls --ca-cert /etc/ssl/mqttsuite/ca.crt</div>
</div><!-- fragment --><h4 class="doxsection"><a class="anchor" id="example-unix-domain-websockets-tls-layered-on-the-ws-endpoint"></a>
Example (Unix Domain WebSockets, TLS layered on the WS endpoint):</h4>
<div class="fragment"><div class="line">mqttintegrator un-wsmqtts \</div>
<div class="line">                  remote --sun-path /tmp/mqttbroker-un-https</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="persist-once-workflow-recommended"></a>
Persist-once workflow (recommended)</h3>
<ul>
<li>Start with explicit CLI flags; verify connectivity and message flow.</li>
<li>Run <b>once</b> with <span class="tt">-w</span> (or <span class="tt">--write-config</span>) to save the configuration.</li>
<li>Thereafter, use <span class="tt">mqttintegrator</span> without flags; override only deltas when needed.</li>
</ul>
<p>Commonly persisted options:</p>
<ul>
<li><span class="tt">--mqtt-session-store &lt;path&gt;</span> — keep client session state across restarts.</li>
<li><span class="tt">--mqtt-mapping-file &lt;path.json&gt;</span> — apply your transformation/normalization rules.</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="websockets-specifics-that-often-trip-clients-1"></a>
WebSockets specifics that often trip clients</h3>
<ul>
<li><b>Subprotocol:</b> the integrator sets <span class="tt">Sec-WebSocket-Protocol: <a class="el" href="namespacemqtt.html">mqtt</a></span>. Ensure the broker accepts it.</li>
<li><b>Request target:</b> use <span class="tt">/ws</span> (do not change unless your broker explicitly uses a different target).</li>
<li><b>Through proxies:</b> <span class="tt">Upgrade</span>, <span class="tt">Connection</span>, and <span class="tt">Sec-WebSocket-Protocol</span> must pass through unchanged.</li>
<li><b>UDS-WS:</b> ensure the <b>sun path</b> matches the broker’s WS UDS listener (e.g., <span class="tt">/tmp/mqttbroker-un-http</span> or <span class="tt">/tmp/mqttbroker-un-https</span>) and that file permissions allow access.</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="diagnostics-hardening--common-pitfalls"></a>
Diagnostics, hardening &amp; common pitfalls</h3>
<p><b>Diagnostics</b></p>
<ul>
<li><b>Cannot connect:</b> verify <span class="tt">remote --host/--port</span> (or <span class="tt">--sun-path</span>) values and broker reachability.</li>
<li><b>TLS failures:</b> hostname mismatch, missing CA, or wrong client certificates.</li>
<li><b>WS upgrade errors:</b> wrong request target (<span class="tt">/ws</span>) or missing <span class="tt"><a class="el" href="namespacemqtt.html">mqtt</a></span> subprotocol.</li>
</ul>
<p><b>Hardening</b></p>
<ul>
<li>Prefer UNIX domain sockets on the same host for reduced attack surface.</li>
<li>Use TLS (and client auth where required) across untrusted networks.</li>
<li>Restrict file permissions for keys and session store.</li>
</ul>
<p><b>Common pitfalls</b></p>
<ul>
<li><b>All instances active:</b> disable unused instances to avoid accidental connections.</li>
<li><b>Wrong broker path:</b> mismatched WS target or socket path leads to silent failures.</li>
<li><b>Mapping file path typos:</b> the integrator starts but no transforms occur—double-check the filename.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="protocol-version-note-1"></a>
Protocol version note</h2>
<ul>
<li>The integrator speaks <b>MQTT 3.1.1</b> as a client. Configure your broker accordingly.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="why-this-layout-works-well-in-production-1"></a>
Why this layout works well in production</h2>
<ul>
<li><b>Single-broker focus:</b> clear operational model—subscribe, transform, and republish on the same connection.</li>
<li><b>Uniform instance model:</b> TCPv4/v6, UNIX sockets, Unix Domain WebSockets, and IP WebSockets share a consistent configuration surface.</li>
<li><b>Persist-once simplicity:</b> Use <span class="tt">-w</span> once; day-to-day runs are minimal and repeatable.</li>
</ul>
<hr  />
<h1 class="doxsection"><a class="anchor" id="mqttbridge"></a>
MQTTBridge</h1>
<p>The <b>MQTTBridge</b> is a <b>pure client-side bridge</b> in the <b>MQTTSuite</b>. It creates one or more <b>logical bridges</b>, where each bridge connects to <b>two or more MQTT brokers</b> and <b>relays topics</b> among them. Forwarding is governed by a single JSON file, <b><span class="tt">bridge-config.json</span></b>. The bridge does <b>not</b> expose listeners; every connection is an <b>outbound client</b> connection to a remote broker.</p>
<p>Like the other MQTTSuite apps, the bridge supports the same transport families (TCP/IPv4, TCP/IPv6, UNIX domain sockets, and WebSockets over these), plus optional Bluetooth (RFCOMM/L2CAP) if built. The <span class="tt">network</span> section of the JSON selects transport and security <b>per broker</b>.</p>
<p><b>Key properties</b></p>
<ul>
<li><b>Multi-broker fan-out:</b> Messages received from one broker are forwarded to all the other brokers in the same logical bridge, subject to <b>topic filters</b>, <b>prefix rules</b>, and <b>loop prevention</b>.</li>
<li><b>Prefixes:</b> Optional <b>bridge-level</b> and <b>broker-level</b> prefixes help avoid collisions and enable simple routing.</li>
<li><b>Loop prevention:</b> Optional per-broker flag to reduce message echo/loops.</li>
<li><b>QoS per subscription:</b> Each broker’s subscription list sets the <b>SUBSCRIBE QoS</b> used toward that broker.</li>
<li><b>Session stores:</b> Optional per-broker on-disk session stores to resume state across restarts.</li>
<li><b>Protocol:</b> MQTT <b>3.1.1</b> client behavior.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="quick-start-recommended-flow-3"></a>
Quick Start (Recommended Flow)</h2>
<h3 class="doxsection"><a class="anchor" id="create-a-minimal-bridge-configjson"></a>
Create a minimal <span class="tt">bridge-config.json</span></h3>
<p>Two brokers, bidirectional, loop prevention on:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;bridges&quot;: [</div>
<div class="line">    {</div>
<div class="line">      &quot;name&quot;: &quot;local↔edge&quot;,</div>
<div class="line">      &quot;prefix&quot;: &quot;bridge/&quot;,</div>
<div class="line">      &quot;brokers&quot;: [</div>
<div class="line">        {</div>
<div class="line">          &quot;network&quot;: {</div>
<div class="line">            &quot;instance_name&quot;: &quot;local-ws&quot;,</div>
<div class="line">            &quot;protocol&quot;: &quot;in&quot;,</div>
<div class="line">            &quot;in&quot;: { &quot;host&quot;: &quot;127.0.0.1&quot;, &quot;port&quot;: 8080 },</div>
<div class="line">            &quot;encryption&quot;: &quot;legacy&quot;,</div>
<div class="line">            &quot;transport&quot;: &quot;websocket&quot;</div>
<div class="line">          },</div>
<div class="line">          &quot;prefix&quot;: &quot;local/&quot;,</div>
<div class="line">          &quot;mqtt&quot;: {</div>
<div class="line">            &quot;client_id&quot;: &quot;bridge-local&quot;,</div>
<div class="line">            &quot;clean_session&quot;: true,</div>
<div class="line">            &quot;loop_prevention&quot;: true</div>
<div class="line">          },</div>
<div class="line">          &quot;topics&quot;: [</div>
<div class="line">            { &quot;topic&quot;: &quot;#&quot;, &quot;qos&quot;: 0 }</div>
<div class="line">          ]</div>
<div class="line">        },</div>
<div class="line">        {</div>
<div class="line">          &quot;network&quot;: {</div>
<div class="line">            &quot;instance_name&quot;: &quot;edge-tcp&quot;,</div>
<div class="line">            &quot;protocol&quot;: &quot;in&quot;,</div>
<div class="line">            &quot;in&quot;: { &quot;host&quot;: &quot;edge.example.net&quot;, &quot;port&quot;: 1883 },</div>
<div class="line">            &quot;encryption&quot;: &quot;legacy&quot;,</div>
<div class="line">            &quot;transport&quot;: &quot;stream&quot;</div>
<div class="line">          },</div>
<div class="line">          &quot;prefix&quot;: &quot;edge/&quot;,</div>
<div class="line">          &quot;mqtt&quot;: {</div>
<div class="line">            &quot;client_id&quot;: &quot;bridge-edge&quot;,</div>
<div class="line">            &quot;clean_session&quot;: true,</div>
<div class="line">            &quot;loop_prevention&quot;: true</div>
<div class="line">          },</div>
<div class="line">          &quot;topics&quot;: [</div>
<div class="line">            { &quot;topic&quot;: &quot;#&quot;, &quot;qos&quot;: 0 }</div>
<div class="line">          ]</div>
<div class="line">        }</div>
<div class="line">      ]</div>
<div class="line">    }</div>
<div class="line">  ]</div>
<div class="line">}</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="run-the-bridge"></a>
Run the bridge:</h3>
<div class="fragment"><div class="line">mqttbridge bridge --definition /etc/mqttsuite/bridge-config.json</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="verify-example"></a>
Verify (example):</h3>
<div class="fragment"><div class="line"># Publish on &#39;local&#39; broker → should appear on &#39;edge&#39; with prefixing</div>
<div class="line">mqttcli in-wsmqtt remote --host 127.0.0.1 --port 8080 \</div>
<div class="line">  pub --topic &#39;sensors/temp&#39; --message &#39;21.5&#39;</div>
<div class="line"> </div>
<div class="line"># Subscribe on edge:</div>
<div class="line">mosquitto_sub -h edge.example.net -p 1883 -t &#39;bridge/local/#&#39; -v</div>
</div><!-- fragment --><blockquote class="doxtable">
<p><b>Persist-once workflow:</b> Like other MQTTSuite apps, you can persist CLI runtime options with <span class="tt">-w</span>. The <b>bridge topology</b> itself lives in <span class="tt">bridge-config.json</span>, so you typically run <span class="tt">mqttbridge --bridge-config-file …</span> thereafter. </p>
</blockquote>
<h2 class="doxsection"><a class="anchor" id="bridge-configuration-json"></a>
Bridge Configuration JSON</h2>
<p>This section shows the <b>overall file structure</b> first, then elaborates on <b>each element</b>. Unknown keys are <b>rejected</b> (<span class="tt">additionalProperties: false</span> throughout the schema).</p>
<h3 class="doxsection"><a class="anchor" id="overall-structure-at-a-glance"></a>
Overall Structure (at a glance)</h3>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;bridges&quot;: [                       // required, ≥ 1 items</div>
<div class="line">    {</div>
<div class="line">      &quot;disabled&quot;: false,             // optional</div>
<div class="line">      &quot;name&quot;: &quot;bridge-name&quot;,         // required (string)</div>
<div class="line">      &quot;prefix&quot;: &quot;bridge/&quot;,           // optional (string, default &quot;&quot;)</div>
<div class="line">      &quot;brokers&quot;: [                   // required, ≥ 1 items</div>
<div class="line">        {</div>
<div class="line">          &quot;disabled&quot;: false,         // optional</div>
<div class="line">          &quot;session_store&quot;: &quot;/var/lib/mqttsuite/mqttbridge/session-1.store&quot;, // optional</div>
<div class="line">          &quot;network&quot;: {               // required</div>
<div class="line">            &quot;instance_name&quot;: &quot;local-ws&quot;,</div>
<div class="line">            &quot;protocol&quot;: &quot;in&quot;,        // one of: in | in6 | un | rc | l2</div>
<div class="line">            &quot;encryption&quot;: &quot;legacy&quot;,  // one of: legacy | tls</div>
<div class="line">            &quot;transport&quot;: &quot;websocket&quot;,// one of: stream | websocket</div>
<div class="line"> </div>
<div class="line">            // exactly one of: in | in6 | un | rc | l2, matching &quot;protocol&quot;</div>
<div class="line">            &quot;in&quot;:  { &quot;host&quot;: &quot;127.0.0.1&quot;, &quot;port&quot;: 8080 }</div>
<div class="line">            // &quot;in6&quot;: { &quot;host&quot;: &quot;::1&quot;, &quot;port&quot;: 8080 }</div>
<div class="line">            // &quot;un&quot;:  { &quot;path&quot;: &quot;/run/mqttbroker.unix&quot; }</div>
<div class="line">            // &quot;rc&quot;:  { &quot;host&quot;:&quot;AA:BB:CC:DD:EE:FF&quot;,&quot;channel&quot;:1 }</div>
<div class="line">            // &quot;l2&quot;:  { &quot;host&quot;:&quot;AA:BB:CC:DD:EE:FF&quot;,&quot;psm&quot;:25 }</div>
<div class="line">          },</div>
<div class="line"> </div>
<div class="line">          &quot;mqtt&quot;: {                  // optional; defaults shown</div>
<div class="line">            &quot;client_id&quot;: &quot;&quot;,</div>
<div class="line">            &quot;keep_alive&quot;: 60,</div>
<div class="line">            &quot;clean_session&quot;: true,</div>
<div class="line">            &quot;will_topic&quot;: &quot;&quot;,</div>
<div class="line">            &quot;will_message&quot;: &quot;&quot;,</div>
<div class="line">            &quot;will_qos&quot;: 0,           // 0..2</div>
<div class="line">            &quot;will_retain&quot;: false,</div>
<div class="line">            &quot;username&quot;: &quot;&quot;,</div>
<div class="line">            &quot;password&quot;: &quot;&quot;,</div>
<div class="line">            &quot;loop_prevention&quot;: false</div>
<div class="line">          },</div>
<div class="line"> </div>
<div class="line">          &quot;prefix&quot;: &quot;local/&quot;,        // optional (string, default &quot;&quot;)</div>
<div class="line">          &quot;topics&quot;: [                // optional (≥ 1), default: [{ &quot;topic&quot;:&quot;#&quot;, &quot;qos&quot;:0 }]</div>
<div class="line">            { &quot;topic&quot;: &quot;#&quot;, &quot;qos&quot;: 0 }</div>
<div class="line">          ]</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        // ... more brokers in this bridge</div>
<div class="line">      ]</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    // ... more bridges</div>
<div class="line">  ]</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Forwarding logic (mental model):</b> <br  />
 Within each configured bridge, the MQTTBridge establishes connections to all configured brokers and subscribes to their specified <span class="tt">topics</span>, ensuring message forwarding begins immediately after connection. Incoming messages that match a subscriptions are <b>forwarded to all the other brokers</b> in the same bridge. When forwarding, the bridge applies (if set):</p>
<div class="fragment"><div class="line">&lt;bridge.prefix&gt; + &lt;source-broker.prefix&gt; + &lt;original-topic&gt;</div>
</div><!-- fragment --><p>Looping is mitigated with <span class="tt">mqtt.loop_prevention: true</span> (per broker) plus sensible prefixing.</p>
<h3 class="doxsection"><a class="anchor" id="elements-in-detail"></a>
Elements in Detail</h3>
<h4 class="doxsection"><a class="anchor" id="root-object"></a>
Root Object</h4>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Field  </th><th class="markdownTableHeadCenter">Type  </th><th class="markdownTableHeadCenter">Required  </th><th class="markdownTableHeadCenter">Default  </th><th class="markdownTableHeadNone">Notes  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt"><a class="el" href="mqttbridge_8cpp.html#a42ab022d86966c58dd006aecc7079182">bridges</a></span>  </td><td class="markdownTableBodyCenter">array  </td><td class="markdownTableBodyCenter">✅  </td><td class="markdownTableBodyCenter">—  </td><td class="markdownTableBodyNone">Must contain <b>≥ 1</b> <span class="tt">bridge</span> objects. Unknown keys rejected.  </td></tr>
</table>
<h4 class="doxsection"><a class="anchor" id="bridge-each-item-in-bridges"></a>
<span class="tt">bridge</span> (each item in <span class="tt">bridges</span>)</h4>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Field  </th><th class="markdownTableHeadCenter">Type  </th><th class="markdownTableHeadCenter">Required  </th><th class="markdownTableHeadCenter">Default  </th><th class="markdownTableHeadNone">Notes  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">disabled</span>  </td><td class="markdownTableBodyCenter">boolean  </td><td class="markdownTableBodyCenter">✖  </td><td class="markdownTableBodyCenter"><span class="tt">false</span>  </td><td class="markdownTableBodyNone">If <span class="tt">true</span>, this whole bridge is ignored.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt">name</span>  </td><td class="markdownTableBodyCenter">string  </td><td class="markdownTableBodyCenter">✅  </td><td class="markdownTableBodyCenter">—  </td><td class="markdownTableBodyNone">Logical name for logs/metrics.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">prefix</span>  </td><td class="markdownTableBodyCenter">string  </td><td class="markdownTableBodyCenter">✖  </td><td class="markdownTableBodyCenter"><span class="tt">""</span>  </td><td class="markdownTableBodyNone">Optional <b>bridge-wide</b> prefix added before forwarding.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt">brokers</span>  </td><td class="markdownTableBodyCenter">array  </td><td class="markdownTableBodyCenter">✅  </td><td class="markdownTableBodyCenter">—  </td><td class="markdownTableBodyNone"><b>≥ 1</b> broker definitions that participate in this bridge.  </td></tr>
</table>
<h4 class="doxsection"><a class="anchor" id="broker-each-item-in-brokers"></a>
<span class="tt">broker</span> (each item in <span class="tt">brokers</span>)</h4>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Field  </th><th class="markdownTableHeadCenter">Type  </th><th class="markdownTableHeadCenter">Required  </th><th class="markdownTableHeadCenter">Default  </th><th class="markdownTableHeadNone">Notes  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">disabled</span>  </td><td class="markdownTableBodyCenter">boolean  </td><td class="markdownTableBodyCenter">✖  </td><td class="markdownTableBodyCenter"><span class="tt">false</span>  </td><td class="markdownTableBodyNone">If <span class="tt">true</span>, this broker does not connect/forward.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt">session_store</span>  </td><td class="markdownTableBodyCenter">string  </td><td class="markdownTableBodyCenter">✖  </td><td class="markdownTableBodyCenter"><span class="tt">""</span>  </td><td class="markdownTableBodyNone">Optional path to persist client session (useful with <span class="tt">clean_session: false</span>).  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">network</span>  </td><td class="markdownTableBodyCenter">object  </td><td class="markdownTableBodyCenter">✅  </td><td class="markdownTableBodyCenter">—  </td><td class="markdownTableBodyNone"><b>Transport selection</b> and concrete address (see <b><span class="tt">network</span></b> below).  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt"><a class="el" href="namespacemqtt.html">mqtt</a></span>  </td><td class="markdownTableBodyCenter">object  </td><td class="markdownTableBodyCenter">✖  </td><td class="markdownTableBodyCenter">defaults  </td><td class="markdownTableBodyNone">MQTT client opts (credentials, last will, <b>loop prevention</b>).  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">prefix</span>  </td><td class="markdownTableBodyCenter">string  </td><td class="markdownTableBodyCenter">✖  </td><td class="markdownTableBodyCenter"><span class="tt">""</span>  </td><td class="markdownTableBodyNone">Optional <b>source-broker</b> prefix added when forwarding <b>from this broker</b> to others.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt">topics</span>  </td><td class="markdownTableBodyCenter">array  </td><td class="markdownTableBodyCenter">✖  </td><td class="markdownTableBodyCenter">defaults  </td><td class="markdownTableBodyNone">Subscription filters <b>towards this broker</b> (SUBSCRIBE QoS per item). Must be ≥1 if present.  </td></tr>
</table>
<blockquote class="doxtable">
<p><b>Subscribe QoS</b> is taken from <span class="tt">topics[].qos</span> toward the <em>source</em> broker. <br  />
 <b>Publish QoS</b> used when forwarding is chosen by the bridge’s policy; align deployment for consistency (QoS 0/1 are common). </p>
</blockquote>
<h4 class="doxsection"><a class="anchor" id="mqtt-client-options"></a>
<span class="tt">mqtt</span> (client options)</h4>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Field  </th><th class="markdownTableHeadCenter">Type  </th><th class="markdownTableHeadCenter">Required  </th><th class="markdownTableHeadCenter">Default  </th><th class="markdownTableHeadNone">Constraints / Notes  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><span class="tt">client_id</span>  </td><td class="markdownTableBodyCenter">string  </td><td class="markdownTableBodyCenter">✖  </td><td class="markdownTableBodyCenter"><span class="tt">""</span>  </td><td class="markdownTableBodyNone">Let the broker assign if empty, or set explicitly.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><span class="tt">keep_alive</span>  </td><td class="markdownTableBodyCenter">integer  </td><td class="markdownTableBodyCenter">✖  </td><td class="markdownTableBodyCenter"><span class="tt">60</span>  </td><td class="markdownTableBodyNone">Seconds between pings.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><span class="tt">clean_session</span>  </td><td class="markdownTableBodyCenter">boolean  </td><td class="markdownTableBodyCenter">✖  </td><td class="markdownTableBodyCenter"><span class="tt">true</span>  </td><td class="markdownTableBodyNone">Set <span class="tt">false</span> to resume session (pair with <span class="tt">session_store</span>).  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><span class="tt">will_topic</span>  </td><td class="markdownTableBodyCenter">string  </td><td class="markdownTableBodyCenter">✖  </td><td class="markdownTableBodyCenter"><span class="tt">""</span>  </td><td class="markdownTableBodyNone">Optional Last Will topic.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><span class="tt">will_message</span>  </td><td class="markdownTableBodyCenter">string  </td><td class="markdownTableBodyCenter">✖  </td><td class="markdownTableBodyCenter"><span class="tt">""</span>  </td><td class="markdownTableBodyNone">Optional Last Will payload.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><span class="tt">will_qos</span>  </td><td class="markdownTableBodyCenter">integer  </td><td class="markdownTableBodyCenter">✖  </td><td class="markdownTableBodyCenter"><span class="tt">0</span>  </td><td class="markdownTableBodyNone"><span class="tt">0..2</span>.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><span class="tt">will_retain</span>  </td><td class="markdownTableBodyCenter">boolean  </td><td class="markdownTableBodyCenter">✖  </td><td class="markdownTableBodyCenter"><span class="tt">false</span>  </td><td class="markdownTableBodyNone">—  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><span class="tt">username</span>  </td><td class="markdownTableBodyCenter">string  </td><td class="markdownTableBodyCenter">✖  </td><td class="markdownTableBodyCenter"><span class="tt">""</span>  </td><td class="markdownTableBodyNone">Broker auth (if required).  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><span class="tt">password</span>  </td><td class="markdownTableBodyCenter">string  </td><td class="markdownTableBodyCenter">✖  </td><td class="markdownTableBodyCenter"><span class="tt">""</span>  </td><td class="markdownTableBodyNone">Broker auth (if required).  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><span class="tt">loop_prevention</span>  </td><td class="markdownTableBodyCenter">boolean  </td><td class="markdownTableBodyCenter">✖  </td><td class="markdownTableBodyCenter"><span class="tt">false</span>  </td><td class="markdownTableBodyNone">Enable to mitigate echo loops. Combine with origin prefix.  </td></tr>
</table>
<h4 class="doxsection"><a class="anchor" id="topics-subscriptions-for-a-broker"></a>
<span class="tt">topics</span> (subscriptions for a broker)</h4>
<p>Each item is a <span class="tt">topic</span> object:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Field  </th><th class="markdownTableHeadCenter">Type  </th><th class="markdownTableHeadCenter">Required  </th><th class="markdownTableHeadCenter">Default  </th><th class="markdownTableHeadNone">Constraints / Notes  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">topic</span>  </td><td class="markdownTableBodyCenter">string  </td><td class="markdownTableBodyCenter">✅  </td><td class="markdownTableBodyCenter"><span class="tt">"#"</span>  </td><td class="markdownTableBodyNone">MQTT filter (<span class="tt">#</span>, <span class="tt">+</span> allowed).  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt">qos</span>  </td><td class="markdownTableBodyCenter">integer  </td><td class="markdownTableBodyCenter">✖  </td><td class="markdownTableBodyCenter"><span class="tt">0</span>  </td><td class="markdownTableBodyNone">One of <span class="tt">0</span>, <span class="tt">1</span>, <span class="tt">2</span> (SUBSCRIBE QoS).  </td></tr>
</table>
<blockquote class="doxtable">
<p>These control which inbound topics are <b>accepted from this broker</b>. Matching messages are forwarded to other brokers. </p>
</blockquote>
<h4 class="doxsection"><a class="anchor" id="network-transport-selection--addressing"></a>
<span class="tt">network</span> (transport selection + addressing)</h4>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Field  </th><th class="markdownTableHeadNone">Type  </th><th class="markdownTableHeadCenter">Required  </th><th class="markdownTableHeadNone">Values / Example  </th><th class="markdownTableHeadNone">Notes  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">instance_name</span>  </td><td class="markdownTableBodyNone">string  </td><td class="markdownTableBodyCenter">✅  </td><td class="markdownTableBodyNone"><span class="tt">"local-ws"</span>  </td><td class="markdownTableBodyNone">Logical name; shows in logs.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt">protocol</span>  </td><td class="markdownTableBodyNone">string  </td><td class="markdownTableBodyCenter">✅  </td><td class="markdownTableBodyNone"><span class="tt">in</span> | <span class="tt">in6</span> | <span class="tt">un</span> | <span class="tt">rc</span> | <span class="tt">l2</span>  </td><td class="markdownTableBodyNone">Selects address object below.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">encryption</span>  </td><td class="markdownTableBodyNone">string  </td><td class="markdownTableBodyCenter">✅  </td><td class="markdownTableBodyNone"><span class="tt">legacy</span> | <span class="tt">tls</span>  </td><td class="markdownTableBodyNone"><span class="tt">tls</span> for TLS (MQTTS/WSS).  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt">transport</span>  </td><td class="markdownTableBodyNone">string  </td><td class="markdownTableBodyCenter">✅  </td><td class="markdownTableBodyNone"><span class="tt">stream</span> | <span class="tt">websocket</span>  </td><td class="markdownTableBodyNone">MQTT over TCP vs WebSockets.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">in</span>  </td><td class="markdownTableBodyNone">object  </td><td class="markdownTableBodyCenter"><em>if <span class="tt">protocol: in</span></em>  </td><td class="markdownTableBodyNone"><span class="tt">{ "host": "127.0.0.1", "port": 1883 }</span>  </td><td class="markdownTableBodyNone">IPv4 host/port.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt">in6</span>  </td><td class="markdownTableBodyNone">object  </td><td class="markdownTableBodyCenter"><em>if <span class="tt">protocol: in6</span></em>  </td><td class="markdownTableBodyNone"><span class="tt">{ "host": "::1", "port": 1883 }</span>  </td><td class="markdownTableBodyNone">IPv6 host/port.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">un</span>  </td><td class="markdownTableBodyNone">object  </td><td class="markdownTableBodyCenter"><em>if <span class="tt">protocol: un</span></em>  </td><td class="markdownTableBodyNone"><span class="tt">{ "path": "/run/mqtt.sock" }</span>  </td><td class="markdownTableBodyNone">Unix domain path (max ~107 chars).  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt">rc</span>  </td><td class="markdownTableBodyNone">object  </td><td class="markdownTableBodyCenter"><em>if <span class="tt">protocol: rc</span></em>  </td><td class="markdownTableBodyNone"><span class="tt">{ "host":"AA:BB:CC:DD:EE:FF", "channel": 1 }</span>  </td><td class="markdownTableBodyNone">Bluetooth RFCOMM.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">l2</span>  </td><td class="markdownTableBodyNone">object  </td><td class="markdownTableBodyCenter"><em>if <span class="tt">protocol: l2</span></em>  </td><td class="markdownTableBodyNone"><span class="tt">{ "host":"AA:BB:CC:DD:EE:FF", "psm": 25 }</span>  </td><td class="markdownTableBodyNone">Bluetooth L2CAP.  </td></tr>
</table>
<p>Exactly <b>one</b> address object (<span class="tt">in</span>/<span class="tt">in6</span>/<span class="tt">un</span>/<span class="tt">rc</span>/<span class="tt">l2</span>) must be present, consistent with <span class="tt">protocol</span>.</p>
<p><b>WebSockets specifics:</b> For WebSockets, the suite uses request target <b><span class="tt">/ws</span></b> and subprotocol <b><span class="tt"><a class="el" href="namespacemqtt.html">mqtt</a></span></b>. No extra fields are needed in the JSON.</p>
<p><b>Address constraints (from schema):</b></p>
<ul>
<li><span class="tt">in</span>, <span class="tt">in6</span>: <span class="tt">port</span> ∈ <span class="tt">[1,65535]</span>, <span class="tt">host</span> is a string (IPv4/IPv6 or hostname).</li>
<li><span class="tt">un</span>: POSIX path, <span class="tt">^/(?:[^\0])+$</span>, <span class="tt">maxLength: 107</span>.</li>
<li><span class="tt">rc</span>: Bluetooth MAC (<span class="tt">^([0-9A-Fa-f]{2}:){5}[0-9A-Fa-f]{2}$</span>), <span class="tt">channel</span> ∈ <span class="tt">[1,30]</span>.</li>
<li><span class="tt">l2</span>: Bluetooth MAC as above, <span class="tt">psm</span> ∈ <span class="tt">[1,65535]</span>.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="best-practices--validation-tips"></a>
Best Practices &amp; Validation Tips</h2>
<ul>
<li><b>Validation:</b> Stick to the schema—unknown keys fail validation (<span class="tt">additionalProperties: false</span>).</li>
<li><b>Secrets:</b> Keep credentials out of VCS; generate the final JSON at deploy time or mount via secrets.</li>
<li><b>Prefixes:</b> Use a <b>bridge prefix</b> (e.g., <span class="tt">bridge/</span>) and <b>origin prefixes</b> (e.g., <span class="tt">local/</span>, <span class="tt">ttn/</span>) to keep topics intelligible and enable filtering.</li>
<li><b>Loop prevention:</b> Enable <span class="tt">mqtt.loop_prevention: true</span> wherever bidirectional paths overlap. Combine with origin prefixing so the bridge recognizes its own forwarded traffic.</li>
<li><b>Subscriptions &amp; QoS:</b> Start broad (<span class="tt">"#"</span>, QoS 0); once data flows, narrow filters. Keep end-to-end QoS consistent.</li>
<li><b>Sessions &amp; LWT:</b> For unstable links, define a <span class="tt">session_store</span> and consider <span class="tt">clean_session: false</span>. Configure Last Will if operators rely on presence/health topics.</li>
<li><b>UNIX domain sockets:</b> Place sockets under <span class="tt">/run</span> or <span class="tt">/var/run</span>; set ownership/permissions for the bridge process.</li>
<li><b>WebSockets:</b> Target <b><span class="tt">/ws</span></b> and ensure the broker accepts subprotocol <b><span class="tt"><a class="el" href="namespacemqtt.html">mqtt</a></span></b>.</li>
<li><b>Diagnostics:</b> <br  />
<ul>
<li><b>No forwarding:</b> Check the <em>source broker’s</em> <span class="tt">topics[]</span> filter and verify the <em>other</em> brokers subscribe to the forwarded, prefixed paths. <br  />
</li>
<li><b>Echo storms:</b> Add prefixes and enable loop prevention on both sides; avoid subscribing to your own bridged prefix everywhere. <br  />
</li>
<li><b>WS handshake failures:</b> Wrong target or missing subprotocol.</li>
</ul>
</li>
</ul>
<hr  />
<h1 class="doxsection"><a class="anchor" id="mqttcli"></a>
MQTTCli</h1>
<p><b>MQTTCli</b> is the command-line client of the <b>MQTTSuite</b>. It can <b>publish</b> messages and <b>subscribe</b> to topics, supports the same transport families as the other apps (<b>TCP/IPv4</b>, <b>TCP/IPv6</b>, <b>UNIX domain sockets</b>, <b>WebSockets</b> over these, with optional <b>TLS</b>), and integrates with the shared <b>SNode.C configuration system</b>. Typical use cases: quick broker smoke tests, scripted data injection, and ad-hoc topic inspection.</p>
<h2 class="doxsection"><a class="anchor" id="quick-start-recommended-flow-4"></a>
Quick Start (Recommended Flow)</h2>
<p>1) <b>Subscribe</b> to everything on a local broker (TCP/IPv4):</p>
<div class="fragment"><div class="line">mqttcli in-mqtt</div>
<div class="line">            remote --host 127.0.0.1</div>
<div class="line">                   --port 1883</div>
<div class="line">            sub --topic &#39;#&#39;</div>
</div><!-- fragment --><p>2) <b>Publish</b> a message:</p>
<div class="fragment"><div class="line">mqttcli in-mqtt</div>
<div class="line">            remote --host 127.0.0.1</div>
<div class="line">                   --port 1883</div>
<div class="line">            pub --topic &#39;test/topic&#39;</div>
<div class="line">                --message &#39;hello&#39;</div>
</div><!-- fragment --><p>3) <b>WebSockets (HTTP)</b> publish:</p>
<div class="fragment"><div class="line">mqttcli in-wsmqtt</div>
<div class="line">            remote --host 127.0.0.1</div>
<div class="line">                   --port 8080</div>
<div class="line">            pub --topic &#39;test/topic&#39;</div>
<div class="line">                --message &#39;hello&#39;</div>
</div><!-- fragment --><p>4) <b>UNIX domain socket</b> publish:</p>
<div class="fragment"><div class="line">mqttcli un-mqtt</div>
<div class="line">            remote --sun-path /tmp/mqttbroker-un-mqtt</div>
<div class="line">            pub --topic &#39;test/topic&#39;</div>
<div class="line">                --message &#39;hello&#39;</div>
</div><!-- fragment --><p>5) <b>Subscribe and publish in one go</b> (handy for quick checks):</p>
<div class="fragment"><div class="line">mqttcli in-mqtt</div>
<div class="line">            remote --host 127.0.0.1</div>
<div class="line">                   --port 1883</div>
<div class="line">            sub --topic &#39;#&#39;</div>
<div class="line">            pub --topic &#39;test/topic&#39;</div>
<div class="line">                --message &#39;hello&#39;</div>
</div><!-- fragment --><blockquote class="doxtable">
<p>Tip: When publishing JSON on a shell, wrap payloads in single quotes to avoid escaping issues: <span class="tt">--message '{"k":1}'</span>. </p>
</blockquote>
<hr  />
<h2 class="doxsection"><a class="anchor" id="command-structure"></a>
Command Structure</h2>
<div class="fragment"><div class="line">mqttcli &lt;instance&gt; [tls …] remote|local &lt;endpoint-options&gt; (sub …)? (pub …)?</div>
</div><!-- fragment --><ul>
<li><b><span class="tt">&lt;<a class="el" href="issue-93_8cpp.html#a44068119bf1b501581a96d624c4f4b8c">instance</a>&gt;</span></b> selects the transport preset (see tables below).</li>
<li><b><span class="tt">remote|local</span></b> chooses endpoint style:<ul>
<li><span class="tt">remote --host &lt;addr&gt; --port &lt;n&gt;</span> for TCP/WebSockets, or</li>
<li><span class="tt">remote --sun-path &lt;path&gt;</span> for UNIX domain sockets.</li>
</ul>
</li>
<li><b><span class="tt">sub</span></b> and <b><span class="tt">pub</span></b> may be combined in a single invocation.</li>
<li><p class="startli"><b>TLS</b> is configured under a <span class="tt">tls</span> group when using <span class="tt">*s</span> instances (e.g., <span class="tt">in-mqtts</span>, <span class="tt">in-wsmqtts</span>):</p>
<div class="fragment"><div class="line">tls --cert &lt;crt&gt; --cert-key &lt;key&gt; --ca-cert &lt;ca&gt;</div>
</div><!-- fragment --></li>
</ul>
<h2 class="doxsection"><a class="anchor" id="supported-transports-2"></a>
Supported Transports</h2>
<h3 class="doxsection"><a class="anchor" id="mqtt-over-tcpip-2"></a>
MQTT over TCP/IP</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><b>Instance</b>  </th><th class="markdownTableHeadCenter">Protocol  </th><th class="markdownTableHeadCenter">Encryption  </th><th class="markdownTableHeadCenter">Port  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b><span class="tt">in-mqtt</span></b>  </td><td class="markdownTableBodyCenter">IPv4  </td><td class="markdownTableBodyCenter">No  </td><td class="markdownTableBodyCenter"><span class="tt">1883</span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b><span class="tt">in-mqtts</span></b>  </td><td class="markdownTableBodyCenter">IPv4  </td><td class="markdownTableBodyCenter">Yes  </td><td class="markdownTableBodyCenter"><span class="tt">8883</span>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b><span class="tt">in6-mqtt</span></b>  </td><td class="markdownTableBodyCenter">IPv6  </td><td class="markdownTableBodyCenter">No  </td><td class="markdownTableBodyCenter"><span class="tt">1883</span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b><span class="tt">in6-mqtts</span></b>  </td><td class="markdownTableBodyCenter">IPv6  </td><td class="markdownTableBodyCenter">Yes  </td><td class="markdownTableBodyCenter"><span class="tt">8883</span>  </td></tr>
</table>
<h3 class="doxsection"><a class="anchor" id="mqtt-over-unix-domain-sockets-2"></a>
MQTT over UNIX Domain Sockets</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><b>Instance</b>  </th><th class="markdownTableHeadCenter">Encryption  </th><th class="markdownTableHeadNone">Path Example  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b><span class="tt">un-mqtt</span></b>  </td><td class="markdownTableBodyCenter">No  </td><td class="markdownTableBodyNone"><span class="tt">/tmp/mqttbroker-un-mqtt</span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b><span class="tt">un-mqtts</span></b>  </td><td class="markdownTableBodyCenter">Yes  </td><td class="markdownTableBodyNone"><span class="tt">/tmp/mqttbroker-un-mqtts</span>  </td></tr>
</table>
<h3 class="doxsection"><a class="anchor" id="mqtt-over-websockets-2"></a>
MQTT over WebSockets</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><b>Instance</b>  </th><th class="markdownTableHeadCenter">Protocol  </th><th class="markdownTableHeadCenter">Encryption  </th><th class="markdownTableHeadCenter">Port  </th><th class="markdownTableHeadCenter">Default Request Target  </th><th class="markdownTableHeadCenter">Sec-WebSocket-Protocol  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b><span class="tt">in-wsmqtt</span></b>  </td><td class="markdownTableBodyCenter">IPv4  </td><td class="markdownTableBodyCenter">No  </td><td class="markdownTableBodyCenter">8080  </td><td class="markdownTableBodyCenter"><span class="tt">/ws</span>  </td><td class="markdownTableBodyCenter"><span class="tt"><a class="el" href="namespacemqtt.html">mqtt</a></span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b><span class="tt">in-wsmqtts</span></b>  </td><td class="markdownTableBodyCenter">IPv4  </td><td class="markdownTableBodyCenter">Yes  </td><td class="markdownTableBodyCenter">8088  </td><td class="markdownTableBodyCenter"><span class="tt">/ws</span>  </td><td class="markdownTableBodyCenter"><span class="tt"><a class="el" href="namespacemqtt.html">mqtt</a></span>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b><span class="tt">in6-wsmqtt</span></b>  </td><td class="markdownTableBodyCenter">IPv6  </td><td class="markdownTableBodyCenter">No  </td><td class="markdownTableBodyCenter">8080  </td><td class="markdownTableBodyCenter"><span class="tt">/ws</span>  </td><td class="markdownTableBodyCenter"><span class="tt"><a class="el" href="namespacemqtt.html">mqtt</a></span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b><span class="tt">in6-wsmqtts</span></b>  </td><td class="markdownTableBodyCenter">IPv6  </td><td class="markdownTableBodyCenter">Yes  </td><td class="markdownTableBodyCenter">8088  </td><td class="markdownTableBodyCenter"><span class="tt">/ws</span>  </td><td class="markdownTableBodyCenter"><span class="tt"><a class="el" href="namespacemqtt.html">mqtt</a></span>  </td></tr>
</table>
<h3 class="doxsection"><a class="anchor" id="mqtt-over-unix-domain-websockets-2"></a>
MQTT over UNIX Domain WebSockets</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft"><b>Instance</b>  </th><th class="markdownTableHeadRight">Encryption  </th><th class="markdownTableHeadNone">Path Example  </th><th class="markdownTableHeadCenter">Default Request Target  </th><th class="markdownTableHeadCenter">Sec-WebSocket-Protocol  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><b><span class="tt">un-wsmqtt</span></b>  </td><td class="markdownTableBodyRight">No  </td><td class="markdownTableBodyNone"><span class="tt">/tmp/mqttbroker-un-http</span>  </td><td class="markdownTableBodyCenter"><span class="tt">/ws</span>  </td><td class="markdownTableBodyCenter"><span class="tt"><a class="el" href="namespacemqtt.html">mqtt</a></span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><b><span class="tt">un-wsmqtts</span></b>  </td><td class="markdownTableBodyRight">Yes  </td><td class="markdownTableBodyNone"><span class="tt">/tmp/mqttbroker-un-https</span>  </td><td class="markdownTableBodyCenter"><span class="tt">/ws</span>  </td><td class="markdownTableBodyCenter"><span class="tt"><a class="el" href="namespacemqtt.html">mqtt</a></span>  </td></tr>
</table>
<h2 class="doxsection"><a class="anchor" id="additions--field-tested-guidance-2"></a>
Additions &amp; Field-Tested Guidance</h2>
<h3 class="doxsection"><a class="anchor" id="tls-quick-checklist"></a>
TLS quick checklist</h3>
<ul>
<li>Use the <span class="tt">*s</span> instances (e.g., <span class="tt">in-mqtts</span>, <span class="tt">in-wsmqtts</span>) when you need TLS.</li>
<li><p class="startli">Provide CA for server verification and certificate/key when mutual auth is required:</p>
<div class="fragment"><div class="line">mqttcli in-mqtts</div>
<div class="line">            remote --host broker.example.org</div>
<div class="line">                   --port 8883</div>
<div class="line">            tls --ca-cert /etc/ssl/mqttsuite/ca.crt</div>
</div><!-- fragment --></li>
<li>Ensure the server name (SNI/hostname) matches the certificate SAN/CN.</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="websockets-specifics"></a>
WebSockets specifics</h3>
<ul>
<li>The subprotocol <b><span class="tt"><a class="el" href="namespacemqtt.html">mqtt</a></span></b> must be negotiated; ensure proxies preserve <span class="tt">Upgrade</span>, <span class="tt">Connection</span>, and <span class="tt">Sec-WebSocket-Protocol</span>.</li>
<li>Default request targets <span class="tt">/</span> and <span class="tt">/ws</span> are accepted by the MQTTSuite WS endpoints.</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="unix-domain-sockets"></a>
UNIX domain sockets</h3>
<ul>
<li>Prefer <span class="tt">/run</span> or <span class="tt">/var/run</span> for service-managed sockets; adjust file <b>ownership/permissions</b> for non-root users.</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="persist-once-optional"></a>
Persist once (optional)</h3>
<ul>
<li><p class="startli">You can persist frequently reused options via <span class="tt">-w</span>:</p>
<div class="fragment"><div class="line">mqttcli in-mqtt</div>
<div class="line">            remote --host mqtt.local</div>
<div class="line">                   --port 1883</div>
<div class="line">            sub --topic &#39;sensors/#&#39;</div>
<div class="line">            -w</div>
</div><!-- fragment --><p class="startli">Thereafter, a plain <span class="tt">mqttcli</span> may reuse the stored configuration.</p>
</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="handy-patterns"></a>
Handy Patterns</h2>
<ul>
<li><p class="startli"><b>Live-tail everything, then publish:</b></p>
<div class="fragment"><div class="line">mqttcli in-mqtt</div>
<div class="line">            remote --host 127.0.0.1</div>
<div class="line">                   --port 1883</div>
<div class="line">            sub --topic &#39;#&#39;</div>
<div class="line">            pub --topic &#39;test/topic&#39;</div>
<div class="line">                --message &#39;hello&#39;</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>Publish JSON:</b></p>
<div class="fragment"><div class="line">mqttcli in-mqtt</div>
<div class="line">            remote --host 127.0.0.1</div>
<div class="line">                   --port 1883</div>
<div class="line">            pub --topic &#39;sensors/room1&#39;</div>
<div class="line">                --message &#39;{&quot;temp&quot;:22.7,&quot;hum&quot;:48}&#39;</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>WS to local Broker UI port (8080):</b></p>
<div class="fragment"><div class="line">mqttcli in-wsmqtt</div>
<div class="line">            remote --host 127.0.0.1</div>
<div class="line">                   --port 8080</div>
<div class="line">            sub --topic &#39;#&#39;</div>
<div class="line">            http --target /ws</div>
</div><!-- fragment --></li>
</ul>
<h2 class="doxsection"><a class="anchor" id="notes-3"></a>
Notes</h2>
<ul>
<li><b>Protocol:</b> MQTT <b>3.1.1</b> (align your client expectations accordingly). </li>
</ul>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
</div><!-- doc-content -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on <span class="timestamp"></span> for MQTTSuite by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>
